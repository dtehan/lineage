# Milestone v4.0: Interactive Graph Experience

**Status:** âœ… SHIPPED 2026-02-07
**Phases:** 19-23
**Total Plans:** 15

## Overview

Transform the lineage graph into an interactive experience with polished animations, enhanced selection features, and a comprehensive detail panel with statistics and DDL display.

**Context:** 70% of features already exist (selection, highlighting, DetailPanel). Focus is on polish and enhancement, not new architecture. No new dependencies needed.

## Phases

### Phase 19: Animation & Transitions

**Goal**: Establish smooth, natural CSS animation patterns that make graph interactions feel polished
**Depends on**: Nothing (starts fresh from v3.0)
**Requirements**: ANIM-01, ANIM-02, ANIM-03, ANIM-04
**Plans**: 3 plans

Plans:

- [x] 19-01: Add CSS transitions to nodes and slide animation to DetailPanel
- [x] 19-02: Unify edge animation timing and move keyframes to CSS
- [x] 19-03: Update DetailPanel tests for animation behavior

**Success Criteria:**
1. User sees smooth fade when nodes highlight/unhighlight (no instant snap)
2. Unrelated nodes dim smoothly when selection active (200-300ms transition)
3. Detail panel slides in/out with animation (not instant appear/disappear)
4. All transitions feel natural with consistent ease-out timing

**Completed:** 2026-02-06

---

### Phase 20: Backend Statistics & DDL API

**Goal**: Provide backend endpoints that supply table/view metadata for the enhanced detail panel
**Depends on**: Nothing (can run parallel with Phase 19)
**Requirements**: API-01, API-02, API-03, API-04, API-05, API-06
**Plans**: 4 plans

Plans:

- [x] 20-01: Go backend vertical slice: domain entities, repository, service, handlers, router, mocks
- [x] 20-02: Python Flask server statistics and DDL endpoints
- [x] 20-03: Fix dataset ID format mismatch (backend accepts name OR dataset_id)
- [x] 20-04: Fix row count N/A and add table DDL support (gap closure from UAT)

**Success Criteria:**
1. API returns statistics (row count, size, dates, owner, type) for any dataset
2. API returns DDL/view definition SQL for views
3. API returns table/column comments when available
4. API returns 404 for missing datasets (not 500 with details)
5. Both tables and views are supported by statistics/DDL endpoints

**Completed:** 2026-02-07

---

### Phase 21: Detail Panel Enhancement

**Goal**: Transform the existing detail panel into a comprehensive metadata viewer with tabs
**Depends on**: Phase 20 (needs statistics/DDL endpoints)
**Requirements**: PANEL-01, PANEL-02, PANEL-03, PANEL-04, PANEL-05, PANEL-06, PANEL-07, PANEL-08
**Plans**: 3 plans

Plans:

- [x] 21-01: Install prism-react-renderer, add TypeScript types, API client methods, TanStack Query hooks
- [x] 21-02: Refactor DetailPanel with tabs, create sub-components, update graph consumers
- [x] 21-03: Update and extend DetailPanel tests for tabbed layout

**Success Criteria:**
1. User can switch between Columns, Statistics, and DDL tabs
2. Statistics tab displays table metadata (row count, size, dates, owner)
3. DDL tab shows view SQL with syntax highlighting
4. Clicking a column name navigates to that column's lineage graph
5. Each tab shows loading state independently while fetching data
6. Failed fetches show graceful error state (not crash or blank)
7. Large content (many columns, long SQL) scrolls independently per tab

**Completed:** 2026-02-06

---

### Phase 22: Selection Features

**Goal**: Enhance selection interaction with viewport control and navigation breadcrumbs
**Depends on**: Phase 21 (breadcrumb appears in panel header)
**Requirements**: SELECT-01, SELECT-02, SELECT-03, SELECT-04, SELECT-05
**Plans**: 2 plans

Plans:

- [x] 22-01: Fit-to-selection viewport control and selection persistence
- [x] 22-02: Selection hierarchy breadcrumb in DetailPanel header

**Success Criteria:**
1. User can click "Fit to selection" to center viewport on highlighted lineage path
2. Fit-to-selection includes appropriate padding around selected nodes
3. Panel header shows selection hierarchy breadcrumb (database > table > column)
4. Breadcrumb updates immediately when user changes selection
5. Selection state persists when user changes graph depth (when possible)

**Completed:** 2026-02-06

---

### Phase 23: Testing & Validation

**Goal**: Ensure all v4.0 features have comprehensive test coverage
**Depends on**: Phases 19-22 (tests verify implemented features)
**Requirements**: TEST-01, TEST-02, TEST-03, TEST-04, TEST-05, TEST-06
**Plans**: 3 plans

Plans:

- [x] 23-01: Tooltip hover tests + ColumnRow node type tests + useFitToSelection hook tests
- [x] 23-02: Go handler tests for statistics/DDL + hover highlight performance benchmarks
- [x] 23-03: E2E panel column click navigation + TEST-06 coverage verification

**Success Criteria:**
1. Unit tests cover hover tooltip behavior for different node types
2. Integration tests verify fit-to-selection viewport calculations
3. E2E tests verify panel column click navigates to new lineage graph
4. Performance tests verify hover responsiveness on 100+ node graphs
5. API tests verify statistics and DDL endpoints (success and error cases)
6. Frontend tests verify tab switching and error state handling

**Completed:** 2026-02-07

---

## Milestone Summary

**Key Decisions:**

- Generic "Internal server error" on 500 errors (API-05 security) for new endpoints, not str(e) pattern
- DBC system view queries individually wrapped in try/except for graceful permission degradation
- DDL endpoint tries RequestTxtOverFlow column first, falls back for older Teradata versions
- Views return null sizeBytes, tables return null viewSql
- OR "name" = ? fallback in all dataset lookups so endpoints accept "database.table" name format
- Service layer resolves name to canonical dataset_id before passing to repo methods
- MAX(RowCount) without IndexNumber filter for robust statistics retrieval
- SHOW TABLE command for CREATE TABLE DDL extraction with tableDdl field
- SQL language built into prism-react-renderer bundled Prism -- no dynamic import needed
- Tab state resets to "columns" on selection change to prevent stale tab data
- effectiveDatasetId computed from prop or selectedColumn.id for graph compatibility
- Edge details remain flat layout (no tabs) -- tabs only for column selection
- max-w-[80px] truncation on database/table names to prevent panel overflow
- FIT_TO_SELECTION_PADDING = 0.15 and DURATION = 300ms matching Phase 19 panel slide timing
- Selection persistence checks storeNodes existence, clears on column disappearance

**Issues Resolved:**

- Row count N/A when statistics only on non-primary indexes (fixed with MAX aggregate)
- Table DDL missing from UI (added SHOW TABLE support with syntax highlighting)
- Dataset lookups failing for "database.table" format (added OR name = ? fallback)
- Panel animation tests checking DOM presence instead of CSS classes (refactored for always-rendered pattern)
- Test failures due to missing QueryClientProvider/MemoryRouter wrappers (added in DetailPanel tests)

**Technical Debt Incurred:**

- Pre-existing test failures in LineageGraph.test.tsx (32 failures) remain unaddressed -- unrelated to v4.0 work

---

_For current project status, see .planning/ROADMAP.md (will be created for next milestone)_
