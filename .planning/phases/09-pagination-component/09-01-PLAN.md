---
phase: 09-pagination-component
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lineage-ui/src/components/common/Pagination.tsx
  - lineage-ui/src/components/common/Pagination.test.tsx
autonomous: true

must_haves:
  truths:
    - "User sees current page number and total pages displayed"
    - "User can click Previous/Next buttons to navigate between pages"
    - "User can click First/Last buttons to jump to boundaries"
    - "User can select page size from dropdown (25, 50, 100, 200)"
    - "User sees 'Showing X-Y of Z items' information"
    - "Pagination controls are usable on mobile viewports (44x44px touch targets)"
  artifacts:
    - path: "lineage-ui/src/components/common/Pagination.tsx"
      provides: "Enhanced pagination component with all features"
      exports: ["Pagination", "PaginationProps"]
    - path: "lineage-ui/src/components/common/Pagination.test.tsx"
      provides: "Comprehensive test coverage"
      min_lines: 400
  key_links:
    - from: "Pagination.tsx"
      to: "lucide-react"
      via: "icon imports"
      pattern: "ChevronsLeft|ChevronsRight|ChevronLeft|ChevronRight|ChevronDown"
    - from: "Pagination.tsx"
      to: "parent components"
      via: "callback props"
      pattern: "onPageChange|onPageSizeChange"
---

<objective>
Enhance the existing Pagination component with First/Last page buttons, page size selector, page number display, ghost button styling, and mobile responsiveness.

Purpose: Provide a complete, reusable pagination control that can be integrated into Asset Browser, Search Results, and Lineage views in subsequent phases.

Output: Enhanced `Pagination.tsx` with comprehensive test coverage in `Pagination.test.tsx`.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-pagination-component/09-CONTEXT.md
@.planning/phases/09-pagination-component/09-RESEARCH.md

# Source files to modify
@lineage-ui/src/components/common/Pagination.tsx
@lineage-ui/src/components/common/Pagination.test.tsx

# Reference patterns
@lineage-ui/src/components/common/Button.tsx
@lineage-ui/src/components/domain/LineageGraph/Toolbar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance Pagination component</name>
  <files>lineage-ui/src/components/common/Pagination.tsx</files>
  <action>
Extend the existing Pagination component with all features specified in CONTEXT.md:

**1. Extend the interface (maintain backward compatibility):**
```typescript
export interface PaginationProps {
  // Existing props (keep as-is)
  totalCount: number;
  limit: number;
  offset: number;
  onPageChange: (offset: number) => void;
  className?: string;
  // New optional props
  pageSize?: number;              // Alias for limit when using page size selector
  onPageSizeChange?: (size: number) => void;
  pageSizeOptions?: number[];     // Default: [25, 50, 100, 200]
  showPageSizeSelector?: boolean; // Default: true when onPageSizeChange provided
  showFirstLast?: boolean;        // Default: true
  showPageInfo?: boolean;         // Default: true
  isLoading?: boolean;            // Disables all buttons when true
}
```

**2. Add new icon imports:**
```typescript
import { ChevronLeft, ChevronRight, ChevronsLeft, ChevronsRight, ChevronDown } from 'lucide-react';
```

**3. Calculate page numbers:**
```typescript
const currentPage = Math.floor(offset / limit) + 1;
const totalPages = Math.ceil(totalCount / limit);
```

**4. Implement ghost button styling per CONTEXT.md decisions:**
- Transparent background
- Border on hover (border-slate-300)
- Minimum 36x36px for desktop, ensure 44x44px touch targets on mobile via padding
- Use consistent class:
```typescript
const buttonClass = `
  inline-flex items-center justify-center gap-1
  min-w-[36px] min-h-[36px] sm:min-w-[auto]
  px-2 py-1.5
  rounded-md
  text-sm text-slate-700
  bg-transparent
  border border-transparent
  hover:border-slate-300 hover:bg-slate-50
  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1
  disabled:opacity-50 disabled:cursor-not-allowed
  disabled:hover:border-transparent disabled:hover:bg-transparent
  transition-colors
`;
```

**5. Add First/Last navigation buttons:**
- First: `<ChevronsLeft />` icon + "First" text (hidden on mobile via `hidden sm:inline`)
- Previous: `<ChevronLeft />` icon + "Previous" text
- Next: "Next" text + `<ChevronRight />` icon
- Last: "Last" text + `<ChevronsRight />` icon
- Disable First/Previous when `offset === 0`
- Disable Next/Last when `offset + limit >= totalCount`

**6. Add page size selector dropdown (follow Toolbar.tsx pattern):**
```typescript
{onPageSizeChange && (
  <div className="relative">
    <label htmlFor="page-size-select" className="sr-only">Items per page</label>
    <select
      id="page-size-select"
      value={limit}
      onChange={(e) => handlePageSizeChange(Number(e.target.value))}
      disabled={isLoading}
      className="appearance-none pl-3 pr-8 py-1.5 text-sm border border-slate-200 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"
      data-testid="pagination-page-size"
    >
      {(pageSizeOptions ?? [25, 50, 100, 200]).map((size) => (
        <option key={size} value={size}>{size} per page</option>
      ))}
    </select>
    <ChevronDown className="absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none" />
  </div>
)}
```

**7. Handle page size change (maintain position):**
```typescript
const handlePageSizeChange = (newSize: number) => {
  // Keep user at approximately same data position
  const currentFirstItem = offset + 1;
  const newOffset = Math.floor((currentFirstItem - 1) / newSize) * newSize;
  onPageSizeChange?.(newSize);
  onPageChange(newOffset);
};
```

**8. Add page number display:**
```typescript
<span className="text-sm text-slate-600 hidden sm:inline" data-testid="pagination-page-info">
  Page {currentPage} of {totalPages}
</span>
```

**9. Responsive layout:**
- Use `flex flex-col sm:flex-row` for stacking on mobile
- Hide text labels on mobile: `<span className="hidden sm:inline">Previous</span>`
- Keep icons visible on all screen sizes
- Page info text: hidden on mobile (icons sufficient)

**10. Wrap in nav element for accessibility:**
```typescript
<nav aria-label="Pagination" className={`... ${className}`}>
```

**11. Handle empty/single page states:**
- When totalCount === 0: Show "Showing 0 items", disable all navigation
- When totalPages <= 1: Disable all navigation buttons, optionally hide entire component
  </action>
  <verify>
Run `cd /Users/Daniel.Tehan/Code/lineage/lineage-ui && npm run build` - should compile without errors.
Manually verify component renders in browser (optional - will be verified by tests).
  </verify>
  <done>
Pagination.tsx exports enhanced component with:
- First/Last buttons with ChevronsLeft/ChevronsRight icons
- Previous/Next buttons with icons + text labels
- Page size selector dropdown (when onPageSizeChange provided)
- Page number display ("Page X of Y")
- Ghost button styling (transparent bg, border on hover)
- Responsive layout (stacked on mobile)
- Accessible nav wrapper with aria-label
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Pagination tests</name>
  <files>lineage-ui/src/components/common/Pagination.test.tsx</files>
  <action>
Extend the existing test file to cover all new functionality. Keep existing tests (they verify backward compatibility).

**Add new test sections:**

**1. First/Last Button Tests:**
```typescript
describe('First/Last Buttons', () => {
  it('disables First button when on first page', () => {
    render(<Pagination totalCount={250} limit={25} offset={0} onPageChange={() => {}} />);
    expect(screen.getByTestId('pagination-first')).toBeDisabled();
  });

  it('enables First button when not on first page', () => {
    render(<Pagination totalCount={250} limit={25} offset={50} onPageChange={() => {}} />);
    expect(screen.getByTestId('pagination-first')).not.toBeDisabled();
  });

  it('disables Last button when on last page', () => {
    render(<Pagination totalCount={250} limit={25} offset={225} onPageChange={() => {}} />);
    expect(screen.getByTestId('pagination-last')).toBeDisabled();
  });

  it('enables Last button when not on last page', () => {
    render(<Pagination totalCount={250} limit={25} offset={0} onPageChange={() => {}} />);
    expect(screen.getByTestId('pagination-last')).not.toBeDisabled();
  });

  it('calls onPageChange with 0 when clicking First', async () => {
    const user = userEvent.setup();
    const onPageChange = vi.fn();
    render(<Pagination totalCount={250} limit={25} offset={100} onPageChange={onPageChange} />);
    await user.click(screen.getByTestId('pagination-first'));
    expect(onPageChange).toHaveBeenCalledWith(0);
  });

  it('calls onPageChange with last page offset when clicking Last', async () => {
    const user = userEvent.setup();
    const onPageChange = vi.fn();
    render(<Pagination totalCount={250} limit={25} offset={0} onPageChange={onPageChange} />);
    await user.click(screen.getByTestId('pagination-last'));
    // Last page offset: Math.floor((250-1) / 25) * 25 = 225
    expect(onPageChange).toHaveBeenCalledWith(225);
  });
});
```

**2. Page Size Selector Tests:**
```typescript
describe('Page Size Selector', () => {
  it('does not show page size selector when onPageSizeChange not provided', () => {
    render(<Pagination totalCount={250} limit={25} offset={0} onPageChange={() => {}} />);
    expect(screen.queryByTestId('pagination-page-size')).not.toBeInTheDocument();
  });

  it('shows page size selector when onPageSizeChange provided', () => {
    render(
      <Pagination
        totalCount={250}
        limit={25}
        offset={0}
        onPageChange={() => {}}
        onPageSizeChange={() => {}}
      />
    );
    expect(screen.getByTestId('pagination-page-size')).toBeInTheDocument();
  });

  it('displays default page size options', () => {
    render(
      <Pagination
        totalCount={250}
        limit={25}
        offset={0}
        onPageChange={() => {}}
        onPageSizeChange={() => {}}
      />
    );
    const select = screen.getByTestId('pagination-page-size');
    expect(select).toHaveDisplayValue('25 per page');
    expect(screen.getByRole('option', { name: '50 per page' })).toBeInTheDocument();
    expect(screen.getByRole('option', { name: '100 per page' })).toBeInTheDocument();
    expect(screen.getByRole('option', { name: '200 per page' })).toBeInTheDocument();
  });

  it('uses custom page size options when provided', () => {
    render(
      <Pagination
        totalCount={250}
        limit={10}
        offset={0}
        onPageChange={() => {}}
        onPageSizeChange={() => {}}
        pageSizeOptions={[10, 20, 50]}
      />
    );
    expect(screen.getByRole('option', { name: '10 per page' })).toBeInTheDocument();
    expect(screen.getByRole('option', { name: '20 per page' })).toBeInTheDocument();
    expect(screen.queryByRole('option', { name: '100 per page' })).not.toBeInTheDocument();
  });

  it('calls onPageSizeChange and onPageChange when changing page size', async () => {
    const user = userEvent.setup();
    const onPageChange = vi.fn();
    const onPageSizeChange = vi.fn();
    render(
      <Pagination
        totalCount={250}
        limit={25}
        offset={50}  // Page 3 (items 51-75)
        onPageChange={onPageChange}
        onPageSizeChange={onPageSizeChange}
      />
    );
    await user.selectOptions(screen.getByTestId('pagination-page-size'), '50');
    expect(onPageSizeChange).toHaveBeenCalledWith(50);
    // Should keep user at same approximate position: item 51 -> offset 50 with size 50
    expect(onPageChange).toHaveBeenCalledWith(50);
  });

  it('recalculates offset correctly when changing page size', async () => {
    const user = userEvent.setup();
    const onPageChange = vi.fn();
    render(
      <Pagination
        totalCount={250}
        limit={25}
        offset={100}  // Page 5 (items 101-125)
        onPageChange={onPageChange}
        onPageSizeChange={() => {}}
      />
    );
    await user.selectOptions(screen.getByTestId('pagination-page-size'), '50');
    // Item 101 with size 50 -> offset 100 (page 3 of 50-item pages)
    expect(onPageChange).toHaveBeenCalledWith(100);
  });
});
```

**3. Page Number Display Tests:**
```typescript
describe('Page Number Display', () => {
  it('displays current page and total pages', () => {
    render(<Pagination totalCount={250} limit={25} offset={50} onPageChange={() => {}} />);
    expect(screen.getByTestId('pagination-page-info')).toHaveTextContent('Page 3 of 10');
  });

  it('shows page 1 of 1 for single page', () => {
    render(<Pagination totalCount={20} limit={25} offset={0} onPageChange={() => {}} />);
    expect(screen.getByTestId('pagination-page-info')).toHaveTextContent('Page 1 of 1');
  });

  it('shows correct page on last page', () => {
    render(<Pagination totalCount={250} limit={25} offset={225} onPageChange={() => {}} />);
    expect(screen.getByTestId('pagination-page-info')).toHaveTextContent('Page 10 of 10');
  });
});
```

**4. Loading State Tests:**
```typescript
describe('Loading State', () => {
  it('disables all buttons when isLoading is true', () => {
    render(
      <Pagination
        totalCount={250}
        limit={25}
        offset={50}
        onPageChange={() => {}}
        onPageSizeChange={() => {}}
        isLoading={true}
      />
    );
    expect(screen.getByTestId('pagination-first')).toBeDisabled();
    expect(screen.getByTestId('pagination-prev')).toBeDisabled();
    expect(screen.getByTestId('pagination-next')).toBeDisabled();
    expect(screen.getByTestId('pagination-last')).toBeDisabled();
    expect(screen.getByTestId('pagination-page-size')).toBeDisabled();
  });
});
```

**5. Empty State Tests:**
```typescript
describe('Empty State', () => {
  it('shows "Showing 0 items" when totalCount is 0', () => {
    render(<Pagination totalCount={0} limit={25} offset={0} onPageChange={() => {}} />);
    expect(screen.getByTestId('pagination-info')).toHaveTextContent('Showing 0 items');
  });

  it('disables all navigation when totalCount is 0', () => {
    render(<Pagination totalCount={0} limit={25} offset={0} onPageChange={() => {}} />);
    expect(screen.getByTestId('pagination-first')).toBeDisabled();
    expect(screen.getByTestId('pagination-prev')).toBeDisabled();
    expect(screen.getByTestId('pagination-next')).toBeDisabled();
    expect(screen.getByTestId('pagination-last')).toBeDisabled();
  });
});
```

**6. Accessibility Tests:**
```typescript
describe('Accessibility', () => {
  it('wraps controls in nav element with aria-label', () => {
    render(<Pagination totalCount={250} limit={25} offset={0} onPageChange={() => {}} />);
    expect(screen.getByRole('navigation', { name: /pagination/i })).toBeInTheDocument();
  });

  it('has accessible labels for all buttons', () => {
    render(<Pagination totalCount={250} limit={25} offset={50} onPageChange={() => {}} />);
    expect(screen.getByRole('button', { name: /first page/i })).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /previous page/i })).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /next page/i })).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /last page/i })).toBeInTheDocument();
  });

  it('has accessible label for page size selector', () => {
    render(
      <Pagination
        totalCount={250}
        limit={25}
        offset={0}
        onPageChange={() => {}}
        onPageSizeChange={() => {}}
      />
    );
    expect(screen.getByLabelText(/items per page/i)).toBeInTheDocument();
  });
});
```
  </action>
  <verify>
Run `cd /Users/Daniel.Tehan/Code/lineage/lineage-ui && npm test -- --run` - all tests should pass.
  </verify>
  <done>
Pagination.test.tsx has comprehensive coverage for:
- First/Last button states and callbacks
- Page size selector (visibility, options, change handling)
- Page number display
- Loading state
- Empty state (totalCount === 0)
- Accessibility (nav wrapper, button labels, select label)
All existing tests continue to pass (backward compatibility).
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `cd /Users/Daniel.Tehan/Code/lineage/lineage-ui && npm run build` - compiles without errors
2. `cd /Users/Daniel.Tehan/Code/lineage/lineage-ui && npm test -- --run` - all tests pass
3. Component can be manually verified at http://localhost:3000 if dev server running
</verification>

<success_criteria>
- Pagination.tsx exports enhanced component with all specified features
- Component is backward compatible (existing consumers continue to work)
- All new features have test coverage
- Build passes, all tests pass
- Ghost button styling matches CONTEXT.md specification
- Responsive layout works (icons visible on mobile, text hidden)
- Accessible: nav wrapper, aria-labels on all interactive elements
</success_criteria>

<output>
After completion, create `.planning/phases/09-pagination-component/09-01-SUMMARY.md`
</output>
