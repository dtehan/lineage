---
phase: 32-update-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/user_guide.md
  - docs/operations_guide.md
autonomous: true

must_haves:
  truths:
    - "User guide caching section documents 5 separate TTL values with correct defaults"
    - "User guide documents ?refresh=true cache bypass parameter"
    - "User guide documents X-Cache and X-Cache-TTL response headers"
    - "User guide toolbar controls table includes Refresh Button row"
    - "User guide configuration reference includes all 5 CACHE_TTL_* environment variables"
    - "Operations guide environment variable table includes all 5 CACHE_TTL_* variables with defaults"
    - "Operations guide includes Redis operational guidance for verifying cache is working"
  artifacts:
    - path: "docs/user_guide.md"
      provides: "Updated caching section, toolbar controls, and configuration reference"
      contains: "CACHE_TTL_LINEAGE"
    - path: "docs/operations_guide.md"
      provides: "Updated env var table and Redis operational guidance"
      contains: "CACHE_TTL_LINEAGE"
  key_links:
    - from: "docs/user_guide.md"
      to: ".env.example"
      via: "CACHE_TTL_* variable names match"
      pattern: "CACHE_TTL_(LINEAGE|ASSETS|STATISTICS|DDL|SEARCH)"
    - from: "docs/operations_guide.md"
      to: ".env.example"
      via: "CACHE_TTL_* variable names match"
      pattern: "CACHE_TTL_(LINEAGE|ASSETS|STATISTICS|DDL|SEARCH)"
---

<objective>
Update user-facing and operator-facing documentation to accurately reflect the Redis caching implementation from v6.0 Phases 28-31.

Purpose: The user guide and operations guide contain stale caching information (single 5-minute TTL, wrong cache key format, missing CACHE_TTL_* env vars, no mention of cache bypass or response headers). A new team deploying this application would get incorrect information.

Output: Updated docs/user_guide.md and docs/operations_guide.md with accurate cache TTL values, key formats, environment variables, X-Cache headers, ?refresh=true bypass, and refresh buttons.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-update-documentation/32-RESEARCH.md

# Source files to cross-reference for accuracy:
@lineage-api/internal/adapter/outbound/redis/cache_keys.go
@lineage-api/internal/adapter/outbound/redis/cache.go
@lineage-api/internal/adapter/inbound/http/cache_middleware.go
@lineage-api/internal/infrastructure/config/config.go
@.env.example
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update user_guide.md caching section, toolbar controls, and configuration reference</name>
  <files>docs/user_guide.md</files>
  <action>
Make three targeted edits to docs/user_guide.md:

**Edit 1: Backend Server Settings table (around line 1017)**
Remove the row `| Cache TTL | 5 minutes |` from the Backend Server Settings table. Cache TTLs are now configurable per data type, not a single built-in value.

**Edit 2: Caching section (lines 1029-1037)**
Replace the entire "### Caching" subsection with accurate content:

```markdown
### Caching

The Go backend caches API responses in Redis using the cache-aside pattern. Each data type has its own configurable TTL:

| Data Type | Default TTL | Environment Variable |
|-----------|-------------|---------------------|
| Lineage graphs | 30 minutes | `CACHE_TTL_LINEAGE` (1800) |
| Asset listings | 15 minutes | `CACHE_TTL_ASSETS` (900) |
| Table statistics | 15 minutes | `CACHE_TTL_STATISTICS` (900) |
| DDL definitions | 30 minutes | `CACHE_TTL_DDL` (1800) |
| Search results | 5 minutes | `CACHE_TTL_SEARCH` (300) |

Cache keys follow the format `ol:{entity}:{operation}:{params}`, for example:
- `ol:lineage:graph:{datasetID}|{fieldName}|{direction}`
- `ol:dataset:get:{datasetID}`
- `ol:namespace:list`

**Cache bypass:** Add `?refresh=true` to any API request to skip the cache and fetch fresh data from Teradata. The fresh result is still written to the cache for subsequent requests.

**Cache response headers:** All v2 API responses include cache status headers:
- `X-Cache: HIT` -- response served from Redis cache
- `X-Cache: MISS` -- response fetched from Teradata
- `X-Cache-TTL: N` -- seconds until cache entry expires (only present on cache hits)

If Redis is unavailable, the application falls back to a no-op cache and continues working without caching. No configuration change is required.
```

**Edit 3: Toolbar Controls table (around line 221)**
Add a Refresh Button row to the Toolbar Controls table, after the Fullscreen Button row:

```
| **Refresh Button** | Force a cache bypass to fetch fresh data from Teradata (sends `?refresh=true` to the API). The button spins while fetching |
```

**Edit 4: Configuration Reference -- Environment Variables section (around line 958)**
After the Redis variables (REDIS_ADDR, REDIS_PASSWORD, REDIS_DB), add a new table group:

```markdown
**Cache TTL Configuration (Go backend only):**

| Variable | Description | Default |
|----------|-------------|---------|
| `CACHE_TTL_LINEAGE` | Lineage graph cache TTL (seconds) | `1800` |
| `CACHE_TTL_ASSETS` | Asset listing cache TTL (seconds) | `900` |
| `CACHE_TTL_STATISTICS` | Table statistics cache TTL (seconds) | `900` |
| `CACHE_TTL_DDL` | DDL definition cache TTL (seconds) | `1800` |
| `CACHE_TTL_SEARCH` | Search results cache TTL (seconds) | `300` |
```

Cross-reference all TTL default values against `lineage-api/internal/infrastructure/config/config.go` and all cache key formats against `lineage-api/internal/adapter/outbound/redis/cache_keys.go` to ensure accuracy.
  </action>
  <verify>
Run: `grep -c "CACHE_TTL_LINEAGE" docs/user_guide.md` -- should return 2 (caching section + config reference)
Run: `grep -c "X-Cache" docs/user_guide.md` -- should return at least 3
Run: `grep "refresh=true" docs/user_guide.md` -- should find matches
Run: `grep "Refresh Button" docs/user_guide.md` -- should find 1 match in toolbar table
Run: `grep "5-minute TTL\|5 minutes" docs/user_guide.md` -- should return 0 (old value removed)
Run: `grep "lineage:{assetId}" docs/user_guide.md` -- should return 0 (old key format removed)
  </verify>
  <done>
User guide accurately documents: 5 configurable cache TTLs with correct defaults, ol:{entity}:{operation}:{params} key format, ?refresh=true bypass parameter, X-Cache/X-Cache-TTL response headers, Refresh Button in toolbar controls, and CACHE_TTL_* environment variables in configuration reference. No stale caching references remain.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update operations_guide.md with CACHE_TTL_* env vars and Redis operational guidance</name>
  <files>docs/operations_guide.md</files>
  <action>
Make two targeted edits to docs/operations_guide.md:

**Edit 1: Environment Variable Reference table (after line 128, after the REDIS_DB row)**
Add 5 new rows to the existing environment variable reference table:

```
| `CACHE_TTL_LINEAGE` | Cache TTL for lineage graphs (seconds) | `1800` | No | Go backend |
| `CACHE_TTL_ASSETS` | Cache TTL for asset listings (seconds) | `900` | No | Go backend |
| `CACHE_TTL_STATISTICS` | Cache TTL for table statistics (seconds) | `900` | No | Go backend |
| `CACHE_TTL_DDL` | Cache TTL for DDL definitions (seconds) | `1800` | No | Go backend |
| `CACHE_TTL_SEARCH` | Cache TTL for search results (seconds) | `300` | No | Go backend |
```

**Edit 2: Redis Connection Failed troubleshooting section (around lines 529-541)**
Expand the existing section to include cache operational guidance. After the existing content ("Note: Redis is only used by the Go backend..."), add:

```markdown
**Verifying cache is active:**

When the Go backend starts with Redis available, the logs will show:
```
level=INFO msg="Redis connection established"
```

If Redis is unavailable, the logs will show:
```
level=WARN msg="Redis unavailable, using no-op cache"
```

**Monitoring cache effectiveness:**

API responses include cache status headers on all v2 endpoints:
- `X-Cache: HIT` -- response served from Redis cache
- `X-Cache: MISS` -- response fetched from Teradata
- `X-Cache-TTL: N` -- seconds until expiration (only on HIT)

Use these headers to monitor cache hit rates. A high proportion of MISS responses may indicate TTLs are too short for the access pattern.

**Forcing fresh data:**

Add `?refresh=true` to any v2 API request to bypass the cache. This is useful when data has been updated in Teradata and the cached response is stale. The UI also provides refresh buttons in the lineage toolbar and asset browser.

**Clearing all cached data:**

To clear all cached data, flush the Redis database:
```bash
redis-cli -h <host> -p <port> FLUSHDB
```

Or restart Redis. The application will automatically repopulate the cache on subsequent requests.
```

Cross-reference the log messages against `lineage-api/cmd/server/main.go` to ensure they match the actual log output.
  </action>
  <verify>
Run: `grep -c "CACHE_TTL_LINEAGE" docs/operations_guide.md` -- should return 1
Run: `grep -c "CACHE_TTL_" docs/operations_guide.md` -- should return at least 5
Run: `grep "X-Cache" docs/operations_guide.md` -- should find matches
Run: `grep "refresh=true" docs/operations_guide.md` -- should find matches
Run: `grep "FLUSHDB" docs/operations_guide.md` -- should find 1 match
  </verify>
  <done>
Operations guide includes all 5 CACHE_TTL_* environment variables in the reference table with correct defaults and descriptions. Redis troubleshooting section expanded with cache verification, monitoring guidance (X-Cache headers), cache bypass instructions, and cache clearing procedure.
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "5-minute\|5 minutes" docs/user_guide.md` returns no matches (stale TTL removed)
2. `grep -rn "lineage:{assetId}" docs/user_guide.md` returns no matches (stale key format removed)
3. `grep -c "CACHE_TTL_" docs/user_guide.md` returns at least 7 (5 in config table + 2 in caching section)
4. `grep -c "CACHE_TTL_" docs/operations_guide.md` returns at least 5
5. All CACHE_TTL_* variable names in docs match those in .env.example
6. All TTL default values in docs match those in lineage-api/internal/infrastructure/config/config.go
</verification>

<success_criteria>
- User guide caching section describes 5 configurable TTLs (not a single 5-minute TTL)
- User guide documents ?refresh=true, X-Cache headers, and refresh buttons
- User guide configuration reference includes CACHE_TTL_* variables
- Operations guide env var table includes CACHE_TTL_* variables
- Operations guide has Redis operational guidance (verification, monitoring, bypass, clearing)
- No stale caching information remains in either file
</success_criteria>

<output>
After completion, create `.planning/phases/32-update-documentation/32-01-SUMMARY.md`
</output>
