---
phase: 32-update-documentation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/developer_manual.md
  - lineage-api/README.md
  - CLAUDE.md
  - lineage-ui/README.md
  - docs/SECURITY.md
autonomous: true

must_haves:
  truths:
    - "Developer manual redis/ directory tree shows all 7 files (cache.go, cache_keys.go, cache_keys_test.go, cache_metadata.go, cache_test.go, cached_openlineage_repo.go, cached_openlineage_repo_test.go)"
    - "Developer manual documents CachedOpenLineageRepository decorator pattern"
    - "Developer manual Key Interfaces table includes TTL method on CacheRepository"
    - "lineage-api README shows go-redis v9.7.3 (not v9.4.0)"
    - "lineage-api README directory tree includes cache_keys.go, cache_metadata.go, cached_openlineage_repo.go"
    - "lineage-api README config table includes CACHE_TTL_* variables"
    - "CLAUDE.md configuration table includes CACHE_TTL_* variables"
    - "CLAUDE.md backend structure tree includes cache files"
    - "lineage-ui README Toolbar.tsx description mentions refresh"
    - "SECURITY.md CORS section mentions X-Cache and X-Cache-TTL in ExposedHeaders"
  artifacts:
    - path: "docs/developer_manual.md"
      provides: "Accurate backend architecture with cache decorator pattern"
      contains: "cached_openlineage_repo.go"
    - path: "lineage-api/README.md"
      provides: "Accurate tech stack and directory tree"
      contains: "v9.7.3"
    - path: "CLAUDE.md"
      provides: "Updated configuration reference and backend structure"
      contains: "CACHE_TTL_LINEAGE"
    - path: "lineage-ui/README.md"
      provides: "Updated Toolbar.tsx description"
      contains: "refresh"
    - path: "docs/SECURITY.md"
      provides: "Updated CORS ExposedHeaders documentation"
      contains: "X-Cache"
  key_links:
    - from: "lineage-api/README.md"
      to: "lineage-api/go.mod"
      via: "go-redis version must match"
      pattern: "v9\\.7\\.3"
    - from: "docs/developer_manual.md"
      to: "lineage-api/internal/adapter/outbound/redis/"
      via: "directory tree must match actual files"
      pattern: "cache_keys\\.go"
---

<objective>
Update developer-facing documentation and project-level configuration references to accurately reflect the Redis caching implementation.

Purpose: The developer manual, API README, CLAUDE.md, UI README, and security docs contain outdated information about the Redis integration (wrong go-redis version, incomplete directory trees, missing cache configuration, no mention of cache-aside pattern). Developers maintaining this codebase need accurate architectural documentation.

Output: Updated developer_manual.md, lineage-api/README.md, CLAUDE.md, lineage-ui/README.md, and SECURITY.md with correct go-redis version, complete Redis directory tree, CachedOpenLineageRepository documentation, CACHE_TTL_* variables, refresh button descriptions, and CORS ExposedHeaders.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-update-documentation/32-RESEARCH.md

# Source files to cross-reference for accuracy:
@lineage-api/internal/adapter/outbound/redis/cache_keys.go
@lineage-api/internal/adapter/outbound/redis/cache.go
@lineage-api/internal/adapter/outbound/redis/cache_metadata.go
@lineage-api/internal/adapter/outbound/redis/cached_openlineage_repo.go
@lineage-api/internal/adapter/inbound/http/cache_middleware.go
@lineage-api/internal/adapter/inbound/http/router.go
@lineage-api/go.mod
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update developer_manual.md backend architecture and key interfaces</name>
  <files>docs/developer_manual.md</files>
  <action>
Make three targeted edits to docs/developer_manual.md:

**Edit 1: Redis directory tree (around line 360-361)**
Replace the single `cache.go` line in the redis/ directory listing with the full file list:

```
│       └── redis/
│           ├── cache.go                    # CacheRepository interface, NoOpCache, CacheTTLConfig
│           ├── cache_keys.go               # Deterministic cache key builder functions
│           ├── cache_keys_test.go          # Cache key builder tests
│           ├── cache_metadata.go           # CacheMetadata context type, bypass signal
│           ├── cache_test.go               # CacheRepository unit tests
│           ├── cached_openlineage_repo.go  # CachedOpenLineageRepository decorator
│           └── cached_openlineage_repo_test.go  # Decorator unit tests
```

Also add `cache_middleware.go` to the inbound/http/ directory listing (alongside router.go, handlers.go, etc.):

```
│   │   │   ├── cache_middleware.go    # Cache control and headers middleware
```

**Edit 2: Layer responsibilities (around line 374)**
Update the redis adapter description from:
```
- **adapter/outbound/redis/** -- Optional Redis cache implementation. Implements `CacheRepository` for caching query results.
```
to:
```
- **adapter/outbound/redis/** -- Redis caching layer using the cache-aside (read-through) pattern. `CachedOpenLineageRepository` is a decorator that wraps the Teradata repository, checking Redis before querying Teradata and populating Redis after a cache miss. Includes deterministic cache key builders, per-data-type TTL configuration, context-based cache metadata propagation, and a `NoOpCache` fallback for when Redis is unavailable. Cache status is communicated to the HTTP layer via request context, where `CacheControl` middleware sets `X-Cache` and `X-Cache-TTL` response headers.
```

**Edit 3: Key Interfaces table (around line 386)**
Update the CacheRepository row from:
```
| `CacheRepository` | Optional caching layer | `Get`, `Set`, `Delete`, `Exists` |
```
to:
```
| `CacheRepository` | Optional caching layer | `Get`, `Set`, `Delete`, `Exists`, `TTL` |
```

Cross-reference the directory tree against the actual files in `lineage-api/internal/adapter/outbound/redis/` and `lineage-api/internal/adapter/inbound/http/` using `ls` to ensure all files are listed.
  </action>
  <verify>
Run: `grep "cached_openlineage_repo.go" docs/developer_manual.md` -- should find 1 match
Run: `grep "cache_keys.go" docs/developer_manual.md` -- should find 1 match
Run: `grep "cache_metadata.go" docs/developer_manual.md` -- should find 1 match
Run: `grep "cache_middleware.go" docs/developer_manual.md` -- should find 1 match
Run: `grep "TTL" docs/developer_manual.md | grep "CacheRepository"` -- should find TTL in methods
Run: `grep "cache-aside" docs/developer_manual.md` -- should find match in layer description
  </verify>
  <done>
Developer manual backend directory tree lists all 7 redis/ files and cache_middleware.go in http/. Layer responsibilities describe the cache-aside decorator pattern. CacheRepository key interface includes TTL method.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update lineage-api/README.md tech stack, directory tree, and configuration</name>
  <files>lineage-api/README.md</files>
  <action>
Make three targeted edits to lineage-api/README.md:

**Edit 1: Technology Stack table (around line 146)**
Change the go-redis version from:
```
| go-redis | v9.4.0 | Cache client |
```
to:
```
| go-redis | v9.7.3 | Cache client (cache-aside pattern) |
```
Cross-reference against `lineage-api/go.mod` to verify the exact version.

**Edit 2: Directory tree (around lines 30-32)**
Expand the redis/ directory listing and add cache_middleware.go to http/:

In the `inbound/http/` section, add after the existing files:
```
│   │   │   ├── cache_middleware.go        # Cache control and headers middleware
```

In the `outbound/redis/` section, replace the bare `# Redis cache implementation` with:
```
│   │       └── redis/              # Redis cache implementation
│   │           ├── cache.go               # CacheRepository, NoOpCache, CacheTTLConfig
│   │           ├── cache_keys.go          # Deterministic cache key builders
│   │           ├── cache_metadata.go      # Cache metadata context type
│   │           └── cached_openlineage_repo.go  # Cache-aside decorator
```

**Edit 3: Configuration table (around lines 128-137)**
After the REDIS_DB row, add the CACHE_TTL_* variables:

```
| `CACHE_TTL_LINEAGE` | Lineage graph cache TTL (seconds) | `1800` |
| `CACHE_TTL_ASSETS` | Asset listing cache TTL (seconds) | `900` |
| `CACHE_TTL_STATISTICS` | Statistics cache TTL (seconds) | `900` |
| `CACHE_TTL_DDL` | DDL cache TTL (seconds) | `1800` |
| `CACHE_TTL_SEARCH` | Search cache TTL (seconds) | `300` |
```
  </action>
  <verify>
Run: `grep "v9.7.3" lineage-api/README.md` -- should find 1 match
Run: `grep "v9.4.0" lineage-api/README.md` -- should return 0 (old version removed)
Run: `grep "cache_keys.go" lineage-api/README.md` -- should find 1 match
Run: `grep "cached_openlineage_repo.go" lineage-api/README.md` -- should find 1 match
Run: `grep "cache_middleware.go" lineage-api/README.md` -- should find 1 match
Run: `grep "CACHE_TTL_LINEAGE" lineage-api/README.md` -- should find 1 match
  </verify>
  <done>
lineage-api README shows go-redis v9.7.3, complete redis/ directory tree with 4 key files, cache_middleware.go in http/ directory, and all 5 CACHE_TTL_* configuration variables with defaults.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update CLAUDE.md, lineage-ui/README.md, and docs/SECURITY.md</name>
  <files>CLAUDE.md, lineage-ui/README.md, docs/SECURITY.md</files>
  <action>
Make targeted edits to three files:

**CLAUDE.md -- Edit 1: Configuration table (around line 289)**
After the REDIS_DB row in the Environment Variables table, add:

```
| `CACHE_TTL_LINEAGE` | Lineage graph cache TTL (seconds) | `1800` |
| `CACHE_TTL_ASSETS` | Asset listing cache TTL (seconds) | `900` |
| `CACHE_TTL_STATISTICS` | Statistics cache TTL (seconds) | `900` |
| `CACHE_TTL_DDL` | DDL cache TTL (seconds) | `1800` |
| `CACHE_TTL_SEARCH` | Search cache TTL (seconds) | `300` |
```

**CLAUDE.md -- Edit 2: Backend Structure tree (around line 117)**
In the `lineage-api/` backend structure section, update the adapter directory to include cache files. After the `inbound/http/` line showing middleware, add or update to show:

In adapter/inbound/http/ add:
```
│       │   ├── cache_middleware.go  # Cache control/headers middleware
```

In adapter/outbound/redis/ replace `cache.go` comment with expanded listing:
```
│       └── outbound/            # Teradata and Redis implementations
│           ├── teradata/
│           └── redis/
│               ├── cache.go                    # CacheRepository, NoOpCache
│               ├── cache_keys.go               # Deterministic key builders
│               ├── cache_metadata.go           # Cache metadata context
│               └── cached_openlineage_repo.go  # Cache-aside decorator
```

**CLAUDE.md -- Edit 3: API Endpoints section (around line 247)**
After the lineage endpoint, add a note:

```
All v2 endpoints support `?refresh=true` to bypass Redis cache. Responses include `X-Cache: HIT|MISS` and `X-Cache-TTL` headers.
```

**lineage-ui/README.md -- Edit 1: Toolbar.tsx description (around line 37)**
Change:
```
│       │   ├── Toolbar.tsx          # Graph controls (depth, direction, export)
```
to:
```
│       │   ├── Toolbar.tsx          # Graph controls (depth, direction, export, refresh)
```

**docs/SECURITY.md -- Edit 1: CORS Configuration development section (around line 117)**
After the existing `AllowedHeaders` line in the development CORS config, add:
```go
ExposedHeaders:  []string{"X-Cache", "X-Cache-TTL"}
```

And in the production example (around line 130), after `Access-Control-Allow-Headers`, add:
```
Access-Control-Expose-Headers: X-Cache, X-Cache-TTL
```
  </action>
  <verify>
Run: `grep "CACHE_TTL_LINEAGE" CLAUDE.md` -- should find 1 match
Run: `grep "cache_keys.go" CLAUDE.md` -- should find 1 match
Run: `grep "refresh=true" CLAUDE.md` -- should find 1 match
Run: `grep "X-Cache" CLAUDE.md` -- should find matches
Run: `grep "refresh" lineage-ui/README.md` -- should find match in Toolbar.tsx line
Run: `grep "X-Cache" docs/SECURITY.md` -- should find matches in CORS sections
  </verify>
  <done>
CLAUDE.md has CACHE_TTL_* variables in config table, updated backend structure tree with cache files, and API endpoints note about ?refresh=true and X-Cache headers. lineage-ui README Toolbar.tsx description includes "refresh". SECURITY.md CORS sections document X-Cache and X-Cache-TTL in ExposedHeaders.
  </done>
</task>

</tasks>

<verification>
1. `grep "v9.4.0" lineage-api/README.md` returns 0 matches (stale version removed)
2. `grep "v9.7.3" lineage-api/README.md` returns 1 match
3. `grep -c "CACHE_TTL_" CLAUDE.md` returns at least 5
4. `grep -c "cached_openlineage_repo.go" docs/developer_manual.md` returns 1
5. `grep -c "cache_middleware.go" docs/developer_manual.md` returns 1
6. `grep "X-Cache" docs/SECURITY.md` finds matches in both dev and prod CORS configs
7. `grep "refresh" lineage-ui/README.md` finds match in Toolbar.tsx comment
8. All directory trees in documentation match actual files on disk
</verification>

<success_criteria>
- Developer manual redis/ tree shows all 7 files and describes cache-aside pattern
- lineage-api README shows go-redis v9.7.3 and includes CACHE_TTL_* variables
- CLAUDE.md configuration table includes all CACHE_TTL_* variables
- CLAUDE.md backend structure tree includes cache files
- lineage-ui README Toolbar.tsx description mentions refresh
- SECURITY.md CORS sections document X-Cache ExposedHeaders
- No stale cache information remains in any updated file
</success_criteria>

<output>
After completion, create `.planning/phases/32-update-documentation/32-02-SUMMARY.md`
</output>
