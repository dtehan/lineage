---
phase: 21-detail-panel-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lineage-ui/package.json
  - lineage-ui/package-lock.json
  - lineage-ui/src/types/openlineage.ts
  - lineage-ui/src/api/client.ts
  - lineage-ui/src/api/hooks/useOpenLineage.ts

autonomous: true

must_haves:
  truths:
    - "Frontend can call statistics endpoint and receive typed response"
    - "Frontend can call DDL endpoint and receive typed response"
    - "Hooks only fetch when enabled flag is true (lazy loading)"
    - "prism-react-renderer is installed and importable"
  artifacts:
    - path: "lineage-ui/src/types/openlineage.ts"
      provides: "DatasetStatisticsResponse and DatasetDDLResponse TypeScript interfaces"
      contains: "DatasetStatisticsResponse"
    - path: "lineage-ui/src/api/client.ts"
      provides: "getDatasetStatistics and getDatasetDDL API methods"
      contains: "getDatasetStatistics"
    - path: "lineage-ui/src/api/hooks/useOpenLineage.ts"
      provides: "useDatasetStatistics and useDatasetDDL TanStack Query hooks"
      contains: "useDatasetStatistics"
  key_links:
    - from: "lineage-ui/src/api/hooks/useOpenLineage.ts"
      to: "lineage-ui/src/api/client.ts"
      via: "openLineageApi.getDatasetStatistics and openLineageApi.getDatasetDDL"
      pattern: "openLineageApi\\.getDataset(Statistics|DDL)"
    - from: "lineage-ui/src/api/client.ts"
      to: "/api/v2/openlineage/datasets/{id}/statistics"
      via: "axios GET request"
      pattern: "datasets.*statistics"
---

<objective>
Install prism-react-renderer dependency and create the API layer foundation (TypeScript types, axios client methods, TanStack Query hooks) for the statistics and DDL endpoints built in Phase 20.

Purpose: The DetailPanel UI components (Plan 02) need typed API hooks to fetch statistics and DDL data. This plan creates those hooks following established codebase patterns so the UI plan can focus purely on component work.

Output: Two new TypeScript interfaces, two new API client methods, two new TanStack Query hooks with `enabled` option for lazy tab fetching, and prism-react-renderer installed for DDL syntax highlighting.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-detail-panel-enhancement/21-RESEARCH.md

# Source files to extend
@lineage-ui/src/types/openlineage.ts
@lineage-ui/src/api/client.ts
@lineage-ui/src/api/hooks/useOpenLineage.ts

# API contract reference (Go DTOs define the response shape)
@lineage-api/internal/application/dto.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install prism-react-renderer and add TypeScript types</name>
  <files>
    lineage-ui/package.json
    lineage-ui/package-lock.json
    lineage-ui/src/types/openlineage.ts
  </files>
  <action>
1. Install prism-react-renderer:
   ```bash
   cd lineage-ui && npm install prism-react-renderer
   ```

2. Add two new interfaces to `lineage-ui/src/types/openlineage.ts` at the end of the file (before the pagination params section). These must match the Go DTOs in `lineage-api/internal/application/dto.go` lines 161-184:

```typescript
// Dataset Statistics and DDL Response Types (Phase 20 API)

export interface DatasetStatisticsResponse {
  datasetId: string;
  databaseName: string;
  tableName: string;
  sourceType: string;            // "TABLE" or "VIEW"
  creatorName?: string;
  createTimestamp?: string;       // ISO 8601 timestamp
  lastAlterTimestamp?: string;    // ISO 8601 timestamp
  rowCount?: number | null;       // null if stats not collected
  sizeBytes?: number | null;      // null for views
  tableComment?: string;
}

export interface DatasetDDLResponse {
  datasetId: string;
  databaseName: string;
  tableName: string;
  sourceType: string;            // "TABLE" or "VIEW"
  viewSql?: string;              // Only populated for views
  truncated: boolean;            // true if SQL was truncated at 12,500 chars
  tableComment?: string;
  columnComments?: Record<string, string>; // columnName -> comment
}
```

Important: The Go DTO uses `omitempty` on optional fields and `*string`/`*int64` pointer types for nullable values. The TypeScript types use optional fields (`?`) and `number | null` to match. The `truncated` field is NOT optional (always present as boolean).
  </action>
  <verify>
    - `cd lineage-ui && npm ls prism-react-renderer` shows the package is installed
    - `npx tsc --noEmit` passes (no type errors)
  </verify>
  <done>
    - prism-react-renderer is in package.json dependencies
    - DatasetStatisticsResponse and DatasetDDLResponse interfaces exist in openlineage.ts
    - TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add API client methods and TanStack Query hooks</name>
  <files>
    lineage-ui/src/api/client.ts
    lineage-ui/src/api/hooks/useOpenLineage.ts
  </files>
  <action>
1. Add two new methods to the `openLineageApi` object in `lineage-ui/src/api/client.ts`. Place them after the existing `unifiedSearch` method and before the `// Lineage` comment. Follow the exact pattern of existing methods (use `apiClientV2`, `encodeURIComponent` for the datasetId):

```typescript
// Statistics and DDL
async getDatasetStatistics(datasetId: string): Promise<DatasetStatisticsResponse> {
  const response = await apiClientV2.get<DatasetStatisticsResponse>(
    `/api/v2/openlineage/datasets/${encodeURIComponent(datasetId)}/statistics`
  );
  return response.data;
},

async getDatasetDDL(datasetId: string): Promise<DatasetDDLResponse> {
  const response = await apiClientV2.get<DatasetDDLResponse>(
    `/api/v2/openlineage/datasets/${encodeURIComponent(datasetId)}/ddl`
  );
  return response.data;
},
```

Also add `DatasetStatisticsResponse` and `DatasetDDLResponse` to the import statement at the top of client.ts.

2. Add two new hooks to `lineage-ui/src/api/hooks/useOpenLineage.ts`. Place them after the existing dataset hooks section and before the lineage hooks section. Follow the existing hook pattern (UseQueryOptions spread, enabled guard):

```typescript
// Statistics and DDL hooks

export function useDatasetStatistics(
  datasetId: string,
  options?: { enabled?: boolean } & Omit<UseQueryOptions<DatasetStatisticsResponse, Error>, 'queryKey' | 'queryFn'>
) {
  const { enabled = true, ...queryOptions } = options ?? {};
  return useQuery({
    queryKey: [...openLineageKeys.all, 'statistics', datasetId],
    queryFn: () => openLineageApi.getDatasetStatistics(datasetId),
    enabled: !!datasetId && enabled,
    staleTime: 5 * 60 * 1000, // Statistics change infrequently
    ...queryOptions,
  });
}

export function useDatasetDDL(
  datasetId: string,
  options?: { enabled?: boolean } & Omit<UseQueryOptions<DatasetDDLResponse, Error>, 'queryKey' | 'queryFn'>
) {
  const { enabled = true, ...queryOptions } = options ?? {};
  return useQuery({
    queryKey: [...openLineageKeys.all, 'ddl', datasetId],
    queryFn: () => openLineageApi.getDatasetDDL(datasetId),
    enabled: !!datasetId && enabled,
    staleTime: 30 * 60 * 1000, // DDL changes very rarely
    ...queryOptions,
  });
}
```

Also add `DatasetStatisticsResponse` and `DatasetDDLResponse` to the import statement at the top of useOpenLineage.ts.

Key design decisions:
- `enabled` defaults to `true` but can be overridden to `false` for lazy tab loading (Statistics/DDL tabs only fetch when active)
- `staleTime` is 5 min for statistics (row counts change occasionally) and 30 min for DDL (view SQL almost never changes)
- Query keys use `openLineageKeys.all` prefix for consistent cache invalidation
  </action>
  <verify>
    - `cd lineage-ui && npx tsc --noEmit` passes (no type errors)
    - `cd lineage-ui && npm test -- --run --reporter=verbose 2>&1 | tail -20` shows no test regressions
  </verify>
  <done>
    - `openLineageApi.getDatasetStatistics(id)` and `openLineageApi.getDatasetDDL(id)` exist in client.ts
    - `useDatasetStatistics(id, { enabled })` and `useDatasetDDL(id, { enabled })` exist in useOpenLineage.ts
    - Both hooks use TanStack Query `enabled` option for lazy fetching
    - All existing tests still pass
  </done>
</task>

</tasks>

<verification>
1. `cd lineage-ui && npm ls prism-react-renderer` -- package installed
2. `cd lineage-ui && npx tsc --noEmit` -- no type errors
3. `cd lineage-ui && npm test -- --run` -- all existing tests pass
4. Grep verification: `grep -n "DatasetStatisticsResponse\|DatasetDDLResponse" lineage-ui/src/types/openlineage.ts` -- both types present
5. Grep verification: `grep -n "getDatasetStatistics\|getDatasetDDL" lineage-ui/src/api/client.ts` -- both client methods present
6. Grep verification: `grep -n "useDatasetStatistics\|useDatasetDDL" lineage-ui/src/api/hooks/useOpenLineage.ts` -- both hooks present
</verification>

<success_criteria>
- prism-react-renderer installed (available for DDL tab in Plan 02)
- Two TypeScript interfaces matching Go DTO response shapes
- Two API client methods calling statistics and DDL endpoints
- Two TanStack Query hooks with lazy-loading `enabled` option
- Zero test regressions
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/21-detail-panel-enhancement/21-01-SUMMARY.md`
</output>
