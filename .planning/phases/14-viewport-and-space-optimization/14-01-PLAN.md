---
phase: 14-viewport-and-space-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lineage-ui/src/utils/graph/layoutEngine.ts
autonomous: true

must_haves:
  truths:
    - "Node spacing is compact with minimal gaps between tables"
    - "Column text remains readable at optimized spacing"
    - "Layout algorithm configured for compact arrangement"
  artifacts:
    - path: "lineage-ui/src/utils/graph/layoutEngine.ts"
      provides: "Compact ELK layout configuration"
      contains: "nodeSpacing"
  key_links:
    - from: "lineage-ui/src/utils/graph/layoutEngine.ts"
      to: "ELK.js layout algorithm"
      via: "elk.spacing.nodeNode and elk.layered.spacing.nodeNodeBetweenLayers"
      pattern: "elk\\.spacing\\.nodeNode|elk\\.layered\\.spacing"
---

<objective>
Configure ELK.js layout algorithm for compact node arrangement with reduced gaps between tables.

Purpose: Reduce unnecessary whitespace between nodes so users see more of the graph without scrolling.
Output: Updated layoutEngine.ts with optimized spacing constants.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@lineage-ui/src/utils/graph/layoutEngine.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Reduce ELK layout spacing constants</name>
  <files>lineage-ui/src/utils/graph/layoutEngine.ts</files>
  <action>
Update the default spacing constants in layoutEngine.ts to create a more compact layout:

1. In the LayoutOptions default values (around line 220-224):
   - Change `nodeSpacing` default from `60` to `40` (33% reduction)
   - Change `layerSpacing` default from `150` to `100` (33% reduction)

2. In the flat layout ELK options (around line 293-294):
   - These use the `nodeSpacing` and `layerSpacing` variables which will now have reduced values

3. In the compound node layout (database clusters, around line 444-445):
   - The root graph uses `nodeSpacing * 2` (80 instead of 120) and `layerSpacing * 1.5` (150 instead of 225)
   - The inner database container uses `nodeSpacing` (40 instead of 60)

4. In the simple nodes fallback (around line 536-537):
   - Uses the same `nodeSpacing` and `layerSpacing` defaults

Note: The DATABASE_CLUSTER_PADDING (40) and DATABASE_CLUSTER_HEADER_HEIGHT (50) should remain unchanged as they control padding within database clusters, not between nodes.

Rationale: Current 60px node spacing and 150px layer spacing creates excessive whitespace. Reducing to 40px/100px maintains readability while showing more content. The column row height (28px) and header height (40px) ensure text remains readable at any spacing.
  </action>
  <verify>
Run the frontend dev server and load a lineage graph:
```bash
cd lineage-ui && npm run dev
```
Navigate to a dataset with multiple tables (e.g., http://localhost:3000/lineage/{dataset-id}/_all).
Visually confirm that tables are closer together than before.
  </verify>
  <done>
- nodeSpacing default changed from 60 to 40
- layerSpacing default changed from 150 to 100
- Graph shows reduced gaps between table nodes
- Column text remains readable
  </done>
</task>

<task type="auto">
  <name>Task 2: Update layout tests to reflect new spacing defaults</name>
  <files>lineage-ui/src/utils/graph/layoutEngine.test.ts</files>
  <action>
Check if layoutEngine.test.ts exists and if it has any tests that assert specific spacing values. If tests exist with hardcoded spacing expectations (60 or 150), update them to the new values (40 and 100).

Search for any tests that might be affected:
- Tests checking default spacing options
- Tests verifying ELK graph configuration
- Snapshot tests that include position data

If no such tests exist, no changes needed. If tests exist but mock ELK.js, they likely won't need changes since the output positions are mocked.

Note: Most position-based tests would need to use approximate comparisons anyway since ELK layout is non-deterministic.
  </action>
  <verify>
Run the layout engine tests:
```bash
cd lineage-ui && npm test -- layoutEngine
```
All tests should pass.
  </verify>
  <done>
- Any spacing-related tests updated if they existed
- npm test -- layoutEngine passes
  </done>
</task>

</tasks>

<verification>
1. Layout engine tests pass: `cd lineage-ui && npm test -- layoutEngine`
2. Full test suite passes: `cd lineage-ui && npm test`
3. Visual verification: Graph shows compact node arrangement with readable text
</verification>

<success_criteria>
- ELK layout uses nodeSpacing=40 and layerSpacing=100 as defaults
- All existing tests pass
- Graph visually shows reduced gaps between tables
- Column names and data types remain readable at the new spacing
</success_criteria>

<output>
After completion, create `.planning/phases/14-viewport-and-space-optimization/14-01-SUMMARY.md`
</output>
