---
phase: 13-graph-loading-experience
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lineage-ui/src/components/common/LoadingProgress.tsx
  - lineage-ui/src/hooks/useLoadingProgress.ts
  - lineage-ui/src/hooks/index.ts
  - lineage-ui/src/components/common/index.ts
  - lineage-ui/src/components/common/LoadingProgress.test.tsx
  - lineage-ui/src/hooks/useLoadingProgress.test.ts
autonomous: true

must_haves:
  truths:
    - "Progress bar shows 0-100% value during loading"
    - "Stage text displays current loading phase"
    - "Progress state transitions through data fetch, layout, render stages"
  artifacts:
    - path: "lineage-ui/src/components/common/LoadingProgress.tsx"
      provides: "Progress bar UI with stage text"
      exports: ["LoadingProgress"]
    - path: "lineage-ui/src/hooks/useLoadingProgress.ts"
      provides: "Loading state management hook"
      exports: ["useLoadingProgress", "LoadingStage"]
  key_links:
    - from: "LoadingProgress.tsx"
      to: "useLoadingProgress"
      via: "hook provides state to component"
      pattern: "progress.*stage"
---

<objective>
Create the loading progress UI component and state management hook for tracking graph loading stages.

Purpose: Provides the foundational building blocks (LoadingProgress component + useLoadingProgress hook) that will be integrated into LineageGraph in Plan 02.

Output: Reusable LoadingProgress component with progress bar and stage text, plus useLoadingProgress hook for managing three-stage loading state (data fetch, layout calculation, rendering).
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@lineage-ui/src/components/common/LoadingSpinner.tsx (existing spinner pattern)
@lineage-ui/src/stores/useLineageStore.ts (Zustand store pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useLoadingProgress hook</name>
  <files>
    lineage-ui/src/hooks/useLoadingProgress.ts
    lineage-ui/src/hooks/index.ts
    lineage-ui/src/hooks/useLoadingProgress.test.ts
  </files>
  <action>
Create a custom hook for managing loading progress state with three stages:

1. Create `lineage-ui/src/hooks/useLoadingProgress.ts`:
   - Define `LoadingStage` type: `'idle' | 'fetching' | 'layout' | 'rendering' | 'complete'`
   - Define `LoadingProgress` interface: `{ stage: LoadingStage; progress: number; message: string }`
   - Export `STAGE_CONFIG` constant mapping stages to progress ranges and messages:
     - idle: 0%, ""
     - fetching: 0-30%, "Loading data..."
     - layout: 30-70%, "Calculating layout..."
     - rendering: 70-95%, "Rendering graph..."
     - complete: 100%, ""
   - Create `useLoadingProgress()` hook that returns:
     - `stage`: current LoadingStage
     - `progress`: number 0-100
     - `message`: string (current stage message)
     - `isLoading`: boolean (true if not idle and not complete)
     - `setStage(stage: LoadingStage)`: function to set stage
     - `setProgress(progress: number)`: function to set exact progress within current stage range
     - `reset()`: function to reset to idle
   - Use useState for stage and progress
   - Derive message from STAGE_CONFIG based on current stage

2. Create or update `lineage-ui/src/hooks/index.ts` to export the hook

3. Create `lineage-ui/src/hooks/useLoadingProgress.test.ts`:
   - Test initial state is idle with 0 progress
   - Test setStage transitions update progress to stage minimum
   - Test setProgress clamps to stage range
   - Test isLoading returns true for non-idle/complete stages
   - Test reset returns to idle state
  </action>
  <verify>
    Run `cd /Users/Daniel.Tehan/Code/lineage/lineage-ui && npm test -- useLoadingProgress.test.ts --run` - all tests pass
  </verify>
  <done>
    Hook correctly manages loading stage transitions with progress percentages and stage messages
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LoadingProgress component</name>
  <files>
    lineage-ui/src/components/common/LoadingProgress.tsx
    lineage-ui/src/components/common/index.ts
    lineage-ui/src/components/common/LoadingProgress.test.tsx
  </files>
  <action>
Create a LoadingProgress component that displays a progress bar with stage text:

1. Create `lineage-ui/src/components/common/LoadingProgress.tsx`:
   - Props interface:
     - `progress: number` (0-100)
     - `message: string` (stage text to display)
     - `size?: 'sm' | 'md' | 'lg'` (default 'md')
   - Render:
     - Outer container: `flex flex-col items-center justify-center` with appropriate gap
     - Progress bar container: rounded background (slate-200), height based on size (sm=2, md=3, lg=4)
     - Progress bar fill: blue-500 background, width based on progress %, transition-all duration-300
     - Message text below bar: slate-600, size based on size prop (sm=xs, md=sm, lg=base)
     - Include proper ARIA attributes: role="progressbar", aria-valuenow, aria-valuemin="0", aria-valuemax="100", aria-label
   - Width: Progress bar should be responsive (w-48 for sm, w-64 for md, w-80 for lg)

2. Update `lineage-ui/src/components/common/index.ts` to export LoadingProgress

3. Create `lineage-ui/src/components/common/LoadingProgress.test.tsx`:
   - Test renders progress bar with correct width percentage
   - Test displays message text
   - Test size prop applies correct classes
   - Test ARIA attributes are present and correct
   - Test progress clamped between 0-100
  </action>
  <verify>
    Run `cd /Users/Daniel.Tehan/Code/lineage/lineage-ui && npm test -- LoadingProgress.test.tsx --run` - all tests pass
  </verify>
  <done>
    LoadingProgress component renders progress bar (0-100%) with stage text and proper accessibility
  </done>
</task>

</tasks>

<verification>
All unit tests pass:
```bash
cd /Users/Daniel.Tehan/Code/lineage/lineage-ui && npm test -- useLoadingProgress.test.ts LoadingProgress.test.tsx --run
```

TypeScript compiles without errors:
```bash
cd /Users/Daniel.Tehan/Code/lineage/lineage-ui && npx tsc --noEmit
```
</verification>

<success_criteria>
1. useLoadingProgress hook manages stage transitions with correct progress percentages
2. LoadingProgress component displays progress bar with visual feedback
3. Stage messages display correctly for each loading phase
4. All tests pass
5. No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-graph-loading-experience/13-01-SUMMARY.md`
</output>
