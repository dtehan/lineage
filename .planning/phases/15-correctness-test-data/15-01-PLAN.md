---
phase: 15-correctness-test-data
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - database/insert_cte_test_data.py
autonomous: true

must_haves:
  truths:
    - "Test database contains 3+ cycle patterns (2-node, 4-node, 5-node)"
    - "Test database contains 3+ diamond patterns (simple, nested, wide)"
    - "Test database contains fan-out patterns (1->5 and 1->10 targets)"
    - "Test database contains fan-in patterns (5->1 and 10->1 sources)"
    - "Test database contains combined patterns (cycle+diamond, fan-out+fan-in)"
  artifacts:
    - path: "database/insert_cte_test_data.py"
      provides: "Comprehensive graph test pattern generation"
      contains: "TEST_CYCLE5_"
    - path: "database/insert_cte_test_data.py"
      provides: "Nested and wide diamond patterns"
      contains: "TEST_NESTED_DIAMOND_"
    - path: "database/insert_cte_test_data.py"
      provides: "Large fan-out patterns"
      contains: "TEST_FANOUT10_"
    - path: "database/insert_cte_test_data.py"
      provides: "Large fan-in patterns"
      contains: "TEST_FANIN10_"
    - path: "database/insert_cte_test_data.py"
      provides: "Combined graph patterns"
      contains: "TEST_COMBINED_"
  key_links:
    - from: "database/insert_cte_test_data.py"
      to: "demo_user.OL_COLUMN_LINEAGE"
      via: "INSERT statements"
      pattern: "INSERT INTO demo_user.OL_COLUMN_LINEAGE"
---

<objective>
Extend test data with comprehensive graph patterns for validating lineage algorithms.

Purpose: Phase 16 (Correctness Validation) needs diverse graph patterns to test cycle detection, diamond deduplication, and fan traversal. Current test data lacks 5-node cycles, nested/wide diamonds, large fan patterns, and combined scenarios.

Output: Extended `insert_cte_test_data.py` with 15+ new test patterns covering all CORRECT-DATA requirements.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@database/insert_cte_test_data.py
@database/setup_lineage_schema.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend insert_cte_test_data.py with comprehensive graph patterns</name>
  <files>database/insert_cte_test_data.py</files>
  <action>
Add new test data INSERT statements to the CTE_TEST_INSERTS list in `database/insert_cte_test_data.py`. Follow the existing pattern format exactly (lineage_id, run_id, source_namespace, source_dataset, source_field, target_namespace, target_dataset, target_field, transformation_type, transformation_subtype, transformation_description, masking, confidence_score, discovered_at, is_active).

**CYCLES (CORRECT-DATA-01) - Add 5-node cycle:**

```
# 5-node cycle: A -> B -> C -> D -> E -> A
# Table: demo_user.CYCLE5_TEST
TEST_CYCLE5_001: col_a -> col_b
TEST_CYCLE5_002: col_b -> col_c
TEST_CYCLE5_003: col_c -> col_d
TEST_CYCLE5_004: col_d -> col_e
TEST_CYCLE5_005: col_e -> col_a
```

**DIAMONDS (CORRECT-DATA-02) - Add nested and wide diamonds:**

```
# Nested diamond: A -> B -> D, A -> C -> D, D -> E -> G, D -> F -> G
# Table: demo_user.NESTED_DIAMOND
TEST_NESTED_DIAMOND_001: col_a -> col_b
TEST_NESTED_DIAMOND_002: col_a -> col_c
TEST_NESTED_DIAMOND_003: col_b -> col_d
TEST_NESTED_DIAMOND_004: col_c -> col_d
TEST_NESTED_DIAMOND_005: col_d -> col_e
TEST_NESTED_DIAMOND_006: col_d -> col_f
TEST_NESTED_DIAMOND_007: col_e -> col_g
TEST_NESTED_DIAMOND_008: col_f -> col_g

# Wide diamond: A -> B, A -> C, A -> D, A -> E, B/C/D/E -> F
# Table: demo_user.WIDE_DIAMOND
TEST_WIDE_DIAMOND_001: col_a -> col_b
TEST_WIDE_DIAMOND_002: col_a -> col_c
TEST_WIDE_DIAMOND_003: col_a -> col_d
TEST_WIDE_DIAMOND_004: col_a -> col_e
TEST_WIDE_DIAMOND_005: col_b -> col_f
TEST_WIDE_DIAMOND_006: col_c -> col_f
TEST_WIDE_DIAMOND_007: col_d -> col_f
TEST_WIDE_DIAMOND_008: col_e -> col_f
```

**FAN-OUT (CORRECT-DATA-03) - Add 1->5 and 1->10 patterns:**

```
# Fan-out 5: source -> target_1..target_5
# Table: demo_user.FANOUT5_TEST
TEST_FANOUT5_001 through TEST_FANOUT5_005: source -> target_1..target_5

# Fan-out 10: source -> target_01..target_10
# Table: demo_user.FANOUT10_TEST
TEST_FANOUT10_001 through TEST_FANOUT10_010: source -> target_01..target_10
```

**FAN-IN (CORRECT-DATA-04) - Add 5->1 and 10->1 patterns:**

```
# Fan-in 5: src_1..src_5 -> target
# Table: demo_user.FANIN5_TEST
TEST_FANIN5_001 through TEST_FANIN5_005: src_1..src_5 -> target

# Fan-in 10: src_01..src_10 -> target
# Table: demo_user.FANIN10_TEST
TEST_FANIN10_001 through TEST_FANIN10_010: src_01..src_10 -> target
```

**COMBINED PATTERNS (CORRECT-DATA-05):**

```
# Combined cycle+diamond: A -> B -> A (cycle), A -> C -> D, A -> D (diamond converging)
# Table: demo_user.COMBINED_CYCLE_DIAMOND
TEST_COMBINED_CD_001: col_a -> col_b (cycle part 1)
TEST_COMBINED_CD_002: col_b -> col_a (cycle part 2)
TEST_COMBINED_CD_003: col_a -> col_c (diamond branch 1)
TEST_COMBINED_CD_004: col_c -> col_d (diamond branch 1 converge)
TEST_COMBINED_CD_005: col_a -> col_d (diamond branch 2 direct)

# Combined fan-out+fan-in: A -> B,C,D (fan-out) and B,C,D -> E (fan-in)
# Table: demo_user.COMBINED_FAN
TEST_COMBINED_FAN_001: col_a -> col_b
TEST_COMBINED_FAN_002: col_a -> col_c
TEST_COMBINED_FAN_003: col_a -> col_d
TEST_COMBINED_FAN_004: col_b -> col_e
TEST_COMBINED_FAN_005: col_c -> col_e
TEST_COMBINED_FAN_006: col_d -> col_e
```

Also update the verification query breakdown to include the new test types:
- 'TEST_CYCLE5%' -> '5-node cycle'
- 'TEST_NESTED_DIAMOND%' -> 'Nested diamond'
- 'TEST_WIDE_DIAMOND%' -> 'Wide diamond'
- 'TEST_FANOUT5%' -> 'Fan-out 5'
- 'TEST_FANOUT10%' -> 'Fan-out 10'
- 'TEST_FANIN5%' -> 'Fan-in 5'
- 'TEST_FANIN10%' -> 'Fan-in 10'
- 'TEST_COMBINED_CD%' -> 'Cycle+Diamond combined'
- 'TEST_COMBINED_FAN%' -> 'Fan-out+Fan-in combined'
  </action>
  <verify>
Run `python database/insert_cte_test_data.py --help` or inspect the file to confirm all new patterns are present. Grep for the pattern IDs:
```
grep -c "TEST_CYCLE5_" database/insert_cte_test_data.py  # Should be 5
grep -c "TEST_NESTED_DIAMOND_" database/insert_cte_test_data.py  # Should be 8
grep -c "TEST_WIDE_DIAMOND_" database/insert_cte_test_data.py  # Should be 8
grep -c "TEST_FANOUT5_" database/insert_cte_test_data.py  # Should be 5
grep -c "TEST_FANOUT10_" database/insert_cte_test_data.py  # Should be 10
grep -c "TEST_FANIN5_" database/insert_cte_test_data.py  # Should be 5
grep -c "TEST_FANIN10_" database/insert_cte_test_data.py  # Should be 10
grep -c "TEST_COMBINED_CD_" database/insert_cte_test_data.py  # Should be 5
grep -c "TEST_COMBINED_FAN_" database/insert_cte_test_data.py  # Should be 6
```
  </verify>
  <done>
- insert_cte_test_data.py contains 5 TEST_CYCLE5_* INSERT statements (5-node cycle)
- insert_cte_test_data.py contains 8 TEST_NESTED_DIAMOND_* INSERT statements
- insert_cte_test_data.py contains 8 TEST_WIDE_DIAMOND_* INSERT statements
- insert_cte_test_data.py contains 5 TEST_FANOUT5_* INSERT statements
- insert_cte_test_data.py contains 10 TEST_FANOUT10_* INSERT statements
- insert_cte_test_data.py contains 5 TEST_FANIN5_* INSERT statements
- insert_cte_test_data.py contains 10 TEST_FANIN10_* INSERT statements
- insert_cte_test_data.py contains 5 TEST_COMBINED_CD_* INSERT statements
- insert_cte_test_data.py contains 6 TEST_COMBINED_FAN_* INSERT statements
  </done>
</task>

<task type="auto">
  <name>Task 2: Execute script and verify patterns in database</name>
  <files>database/insert_cte_test_data.py</files>
  <action>
Run the updated script to populate the test database:

```bash
cd database && python insert_cte_test_data.py
```

The script will:
1. Connect to Teradata
2. Delete existing TEST_* records
3. Insert all test patterns (old + new)
4. Display count breakdown by test type

Verify the output shows:
- 5-node cycle: 5 records
- Nested diamond: 8 records
- Wide diamond: 8 records
- Fan-out 5: 5 records
- Fan-out 10: 10 records
- Fan-in 5: 5 records
- Fan-in 10: 10 records
- Cycle+Diamond combined: 5 records
- Fan-out+Fan-in combined: 6 records

Total new records: 62
Total including existing patterns: ~90 (varies based on existing data)
  </action>
  <verify>
Script output shows successful insertion and the breakdown includes all new test types with correct record counts.

Expected output pattern:
```
  Breakdown by test type:
    - 5-node cycle: 5 records
    - Nested diamond: 8 records
    - Wide diamond: 8 records
    ...
```
  </verify>
  <done>
- Script executes without errors
- All new pattern types appear in the breakdown output
- Record counts match expected values for each pattern type
- Total TEST_* records in OL_COLUMN_LINEAGE is 80+ (original ~28 + new ~62)
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Script file contains all 62 new INSERT statements (9 pattern groups)
2. Database contains all test patterns with correct record counts
3. Script output shows complete breakdown with no failures
</verification>

<success_criteria>
1. `grep -c "TEST_" database/insert_cte_test_data.py` returns 90+ (original + new patterns)
2. Script runs successfully and outputs record counts for all 9 new pattern groups
3. Database contains 3+ cycle patterns (2-node, 4-node, 5-node)
4. Database contains 3+ diamond patterns (simple, nested, wide)
5. Database contains fan-out patterns (1->5, 1->10)
6. Database contains fan-in patterns (5->1, 10->1)
7. Database contains combined patterns (cycle+diamond, fan-out+fan-in)
</success_criteria>

<output>
After completion, create `.planning/phases/15-correctness-test-data/15-01-SUMMARY.md`
</output>
