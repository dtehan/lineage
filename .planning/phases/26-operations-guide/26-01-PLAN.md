---
phase: 26-operations-guide
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/operations_guide.md
autonomous: true

must_haves:
  truths:
    - "Operations guide documents all system prerequisites with pinned minimum versions (Go 1.23+, Node.js 18+, Python 3.9+, Teradata access)"
    - "Operations guide provides step-by-step installation instructions including Python venv, Go build, and frontend build"
    - "Operations guide has a complete environment variable reference table with name, description, default, required/optional, and which component uses each variable"
    - "Operations guide documents database schema creation (OL_* tables), QVCI verification/enablement, and both lineage population methods (fixtures vs DBQL)"
    - "Operations guide documents running both Go and Python backends, and both frontend dev server and production build"
    - "QVCI is called out in Prerequisites as a planning item, not buried only in Database Setup"
    - "Redis is clearly documented as OPTIONAL with graceful fallback"
  artifacts:
    - path: "docs/operations_guide.md"
      provides: "Operations guide covering prerequisites through running the application"
      contains: "QVCI"
  key_links:
    - from: "docs/operations_guide.md"
      to: "docs/SECURITY.md"
      via: "Cross-reference link for production security details"
      pattern: "SECURITY.md"
    - from: "docs/operations_guide.md"
      to: ".env.example"
      via: "Environment variable reference consistency"
      pattern: "TERADATA_HOST|TERADATA_PASSWORD|API_PORT|REDIS_ADDR"
---

<objective>
Create the first half of `docs/operations_guide.md` covering prerequisites, installation, configuration, database setup, and running the application.

Purpose: An operations team starting from zero can install prerequisites, configure the application, set up the database, and start the application using only this guide. This is a net-new file -- the root README already links to `docs/operations_guide.md` with a "coming in v5.0" note.

Output: `docs/operations_guide.md` with sections: header/TOC, Prerequisites, Installation, Configuration, Database Setup, Running the Application. Production hardening, architecture diagram, and troubleshooting will be added by Plan 26-02.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/26-operations-guide/26-RESEARCH.md

Source files to consolidate content from:
@CLAUDE.md
@.env.example
@docs/SECURITY.md (reference only -- do not duplicate)
@docs/user_guide.md (troubleshooting and config sections)

Key verified data from research:
- Go 1.23+ (go.mod), Node.js 18+ (package.json/user_guide), Python 3.9+ (user_guide)
- Python deps: teradatasql>=17.20.0, flask>=3.0.0, flask-cors>=4.0.0, requests>=2.31.0, python-dotenv>=1.0.0, sqlglot>=25.0.0
- Config precedence: env vars > .env file > config.yaml > defaults
- Legacy fallbacks: TD_* for TERADATA_*, PORT for API_PORT
- Server timeouts: 15s read, 60s write, 60s idle, 30s graceful shutdown
- 9 OL_* tables + 17 indexes
- QVCI is a DBA-level Teradata config requiring database restart
- Redis is optional -- application falls back gracefully
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create operations guide with Prerequisites, Installation, and Configuration sections</name>
  <files>docs/operations_guide.md</files>
  <action>
Create `docs/operations_guide.md` as a new file with the following structure. Use operational framing throughout (deploying, not developing).

**Header and Table of Contents:**
```markdown
# Operations Guide

This guide enables an operations team to deploy the Lineage application from scratch. It covers prerequisites, installation, configuration, database setup, and production hardening.

**Related documentation:**
- [User Guide](user_guide.md) -- End-user feature documentation
- [Security Documentation](SECURITY.md) -- Detailed production security requirements
- [Developer Manual](developer_manual.md) -- Development environment and contributing (coming in v5.0)

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Installation](#installation)
3. [Configuration](#configuration)
4. [Database Setup](#database-setup)
5. [Running the Application](#running-the-application)
6. [Production Deployment](#production-deployment)
7. [Architecture](#architecture)
8. [Troubleshooting](#troubleshooting)
```

**Prerequisites section:**
Document required software with pinned minimum versions. Organize into Required and Optional subsections.

Required:
- **Python 3.9+** -- Backend server (Flask) and database scripts
- **Node.js 18+** -- Frontend build and development
- **npm** -- Comes with Node.js
- **Teradata access** -- Network connectivity to a Teradata instance on port 1025 (or configured port)
- **Teradata QVCI** -- Must be enabled on the Teradata instance (requires DBA coordination; see Database Setup section). This is a system-level configuration that requires a database restart -- plan for a maintenance window if not already enabled.

Optional:
- **Go 1.23+** -- Only needed if running the Go backend instead of the Python backend
- **Redis 6+** -- Optional caching layer. The application falls back gracefully without Redis. Only beneficial for high-traffic production deployments.

Include a note: "Both a Go backend and a Python (Flask) backend are provided. Most deployments use the Python backend for simplicity. The Go backend offers better performance for high-concurrency scenarios."

**Installation section:**
Step-by-step installation. Number every step.

1. Clone the repository
2. Set up Python environment:
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate    # Linux/macOS
   # .venv\Scripts\activate     # Windows
   pip install -r requirements.txt
   ```
3. Configure environment (copy .env.example):
   ```bash
   cp .env.example .env
   # Edit .env with your Teradata credentials
   ```
4. Build the frontend:
   ```bash
   cd lineage-ui
   npm install
   npm run build    # Creates dist/ directory with static files
   ```
5. (Optional) Build the Go backend:
   ```bash
   cd lineage-api
   make build       # Creates bin/server binary
   ```

**Configuration section:**
Start with a note about configuration precedence: Environment variables > .env file > config.yaml (Go only) > Default values.

Create a comprehensive environment variable reference table with columns: Variable, Description, Default, Required, Used By.

Include ALL variables from research:

| Variable | Description | Default | Required | Used By |
|----------|-------------|---------|----------|---------|
| `TERADATA_HOST` | Teradata hostname or IP address | -- | Yes | All |
| `TERADATA_USER` | Teradata username | `demo_user` | No | All |
| `TERADATA_PASSWORD` | Teradata password | -- | Yes | All |
| `TERADATA_DATABASE` | Default database name | `demo_user` | No | All |
| `TERADATA_PORT` | Teradata port number | `1025` | No | All |
| `API_PORT` | HTTP server port | `8080` | No | Backend |
| `REDIS_ADDR` | Redis server address | `localhost:6379` | No | Go backend |
| `REDIS_PASSWORD` | Redis password | (empty) | No | Go backend |
| `REDIS_DB` | Redis database number | `0` | No | Go backend |
| `VALIDATION_MAX_DEPTH_LIMIT` | Maximum traversal depth upper bound | `20` | No | Go backend |
| `VALIDATION_DEFAULT_MAX_DEPTH` | Default lineage traversal depth | `5` | No | Go backend |
| `VALIDATION_MIN_MAX_DEPTH` | Minimum traversal depth lower bound | `1` | No | Go backend |

After the table, add a "Legacy Variables" subsection documenting that `TD_HOST`, `TD_USER`, `TD_PASSWORD`, `TD_DATABASE` are supported as fallbacks for `TERADATA_*` variables, and `PORT` is a fallback for `API_PORT`. Mark them as deprecated.

Add a "Go Server Configuration File" subsection noting that the Go backend also supports `config.yaml` in the `lineage-api/` directory. This file is optional and any values set in environment variables or `.env` take precedence.

Add a "Server Timeouts" subsection documenting the Go server's built-in timeouts:
- Read timeout: 15 seconds
- Write timeout: 60 seconds
- Idle timeout: 60 seconds
- Graceful shutdown: 30 seconds
  </action>
  <verify>
Read `docs/operations_guide.md` and confirm:
1. TOC has all 8 sections listed
2. Prerequisites lists Go 1.23+, Node.js 18+, Python 3.9+ with version numbers
3. QVCI is mentioned in Prerequisites with note about DBA coordination and maintenance window
4. Redis is marked as Optional
5. Installation has numbered steps including Python venv, .env copy, frontend build
6. Configuration table has all 12 environment variables with correct defaults
7. Legacy variables (TD_*, PORT) are documented as deprecated
8. Server timeouts are documented (15s read, 60s write, 60s idle, 30s shutdown)
  </verify>
  <done>
Operations guide created with Prerequisites (pinned versions, QVCI early warning, Redis optional), Installation (numbered steps), and Configuration (complete env var table, legacy vars, server timeouts).
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Database Setup and Running the Application sections</name>
  <files>docs/operations_guide.md</files>
  <action>
Append the following sections to `docs/operations_guide.md` after the Configuration section.

**Database Setup section:**
Organize into subsections that follow the operational workflow.

**4.1 Verify QVCI Status:**
Explain what QVCI is (Queryable View Column Index -- enables efficient retrieval of view column information via DBC.ColumnsJQV). Provide the check command:
```sql
-- Try querying DBC.ColumnsJQV
-- If you receive error 9719, QVCI needs to be enabled
SELECT TOP 1 * FROM DBC.ColumnsJQV;
```

Provide enablement instructions (requires DBA privileges + database restart):
```bash
dbscontrol << EOF
M internal 551=false
W
EOF
```

Note: This is a system-level change requiring DBA privileges and a database restart. Plan for a maintenance window.

If QVCI cannot be enabled, reference the fallback approach documented in CLAUDE.md (modify populate_lineage.py to use DBC.ColumnsV instead of DBC.ColumnsJQV).

**4.2 Create Schema:**
```bash
cd database
python scripts/setup/setup_lineage_schema.py --openlineage
```

Document what this creates: 9 OL_* tables with 17 indexes. List the tables in a table:

| Table | Purpose |
|-------|---------|
| `OL_NAMESPACE` | Data source namespaces (teradata://host:port) |
| `OL_DATASET` | Dataset registry (tables/views) |
| `OL_DATASET_FIELD` | Field definitions (columns) |
| `OL_JOB` | Job definitions (ETL processes) |
| `OL_RUN` | Job execution runs |
| `OL_RUN_INPUT` | Run input datasets |
| `OL_RUN_OUTPUT` | Run output datasets |
| `OL_COLUMN_LINEAGE` | Column-level lineage with transformation types |
| `OL_SCHEMA_VERSION` | Schema version tracking |

Note: The `--openlineage` flag is required. Without it, the script creates the older LIN_* tables which are not compatible with the current application.

**4.3 Create Test Data (Optional):**
For testing and demo purposes only. Not needed for production deployments with existing Teradata tables.
```bash
python scripts/setup/setup_test_data.py
```
This creates sample medallion architecture tables (SRC -> STG -> DIM -> FACT) in the configured database.

**4.4 Populate Lineage Data:**
Document both population methods.

**Fixtures Mode (Default)** -- uses hardcoded column mappings for demo/testing:
```bash
python scripts/populate/populate_lineage.py
```

**DBQL Mode** -- extracts lineage from executed SQL in Teradata query logs:
```bash
python scripts/populate/populate_lineage.py --dbql
python scripts/populate/populate_lineage.py --dbql --since "2024-01-01"  # Since specific date
```

Note: DBQL mode requires access to `DBC.DBQLogTbl` and `DBC.DBQLSQLTbl`. The Teradata user must have SELECT privileges on these views.

**Dry Run** -- preview what would be populated without making changes:
```bash
python scripts/populate/populate_lineage.py --dry-run
```

After population, populate metadata for the tables:
```bash
python scripts/populate/populate_test_metadata.py
```

**Running the Application section:**
Document startup for both backends and the frontend.

**5.1 Start the Backend:**

**Python Backend (recommended for most deployments):**
```bash
cd lineage-api
python python_server.py    # Starts on port 8080 (or API_PORT)
```

**Go Backend:**
```bash
cd lineage-api
make build && ./bin/server    # Build and run
# Or for development:
go run cmd/server/main.go     # Run without building
```

Both backends serve the same API endpoints and are interchangeable. The Python backend is simpler to deploy (no compilation). The Go backend offers better performance and includes Redis caching support.

**5.2 Start the Frontend:**

**Development mode (hot reload, proxies API to localhost:8080):**
```bash
cd lineage-ui
npm run dev    # Starts on port 3000 or 5173
```

**Production mode (build static files, serve via web server):**
```bash
cd lineage-ui
npm run build    # Outputs to dist/ directory
```

The `dist/` directory contains static HTML, CSS, and JavaScript files. In production, serve these files using a reverse proxy (Nginx, Traefik, etc.) that also proxies `/api/*` requests to the backend. See the Production Deployment section.

Note: Do NOT use `npm run dev` in production. The Vite dev server is not designed for production use.

**5.3 Verify the Deployment:**
```bash
# Check backend health
curl http://localhost:8080/health

# Check API endpoint
curl http://localhost:8080/api/v2/openlineage/namespaces

# Access the frontend
# Development: http://localhost:3000 or http://localhost:5173
# Production: your configured domain
```

**5.4 Startup Order:**
1. Teradata database (must already be running)
2. Redis (optional -- start before backend if using caching)
3. Backend server (Python or Go)
4. Frontend (dev server or web server serving static files)

Leave placeholder comments for the remaining sections that Plan 26-02 will fill:
```markdown
## Production Deployment

*Section content to be added.*

## Architecture

*Section content to be added.*

## Troubleshooting

*Section content to be added.*
```
  </action>
  <verify>
Read `docs/operations_guide.md` and confirm:
1. Database Setup section has QVCI verification step with SQL check and dbscontrol command
2. Schema creation command uses `--openlineage` flag
3. All 9 OL_* tables are listed with purposes
4. Both lineage population methods documented (fixtures and DBQL)
5. DBQL mode notes DBC.DBQLogTbl and DBC.DBQLSQLTbl access requirement
6. Both Python and Go backend startup commands provided
7. Frontend dev vs production build clearly distinguished
8. Deployment verification curl commands included
9. Startup order documented (Teradata -> Redis -> Backend -> Frontend)
10. Placeholder sections exist for Production Deployment, Architecture, Troubleshooting
  </verify>
  <done>
Operations guide has complete Database Setup section (QVCI, schema, population) and Running the Application section (both backends, frontend dev vs production, verification, startup order). OPS-01 through OPS-08 requirements are satisfied.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Read the full `docs/operations_guide.md` and verify no broken markdown formatting
2. Verify requirement coverage:
   - OPS-01: Prerequisites with Go 1.23+, Node.js 18+, Python 3.9+, Teradata access
   - OPS-02: Step-by-step installation instructions
   - OPS-03: All TERADATA_* env vars documented with defaults
   - OPS-04: API_PORT and server config (timeouts) documented
   - OPS-05: Redis config documented as optional
   - OPS-06: OL_* schema creation with --openlineage flag
   - OPS-07: Both fixtures and DBQL population methods documented
   - OPS-08: QVCI verification, enablement, and fallback documented
3. Verify QVCI appears in both Prerequisites (early warning) and Database Setup (procedure)
4. Verify Redis is marked Optional in Prerequisites and Configuration
5. Verify both Python and Go backends are documented for Running the Application
6. Verify frontend production build (`npm run build` + static serving) is distinguished from dev server
</verification>

<success_criteria>
- docs/operations_guide.md exists with TOC, Prerequisites, Installation, Configuration, Database Setup, Running the Application sections
- All 12 environment variables documented in reference table
- QVCI mentioned in Prerequisites AND Database Setup
- Redis documented as optional throughout
- Both backend options (Python/Go) documented
- Frontend dev vs production clearly distinguished
- Placeholder sections exist for Plan 26-02 to complete
</success_criteria>

<output>
After completion, create `.planning/phases/26-operations-guide/26-01-SUMMARY.md`
</output>
