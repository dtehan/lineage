---
phase: 19-animation-transitions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lineage-ui/src/components/domain/LineageGraph/TableNode/TableNode.tsx
  - lineage-ui/src/components/domain/LineageGraph/TableNode/ColumnRow.tsx
  - lineage-ui/src/components/domain/LineageGraph/DetailPanel.tsx
  - lineage-ui/src/index.css
autonomous: true

must_haves:
  truths:
    - "User sees smooth 200ms fade when nodes highlight or unhighlight"
    - "User sees smooth 200ms fade when unrelated nodes dim during selection"
    - "Detail panel slides in/out with 300ms animation when opened/closed"
    - "All transitions use ease-out timing and feel natural"
    - "Users with prefers-reduced-motion see instant changes (no animation)"
  artifacts:
    - path: "lineage-ui/src/components/domain/LineageGraph/TableNode/TableNode.tsx"
      provides: "Node opacity via CSS classes with transition"
      contains: "transition-opacity"
    - path: "lineage-ui/src/components/domain/LineageGraph/TableNode/ColumnRow.tsx"
      provides: "Column row opacity via CSS classes with transition"
      contains: "transition-opacity"
    - path: "lineage-ui/src/components/domain/LineageGraph/DetailPanel.tsx"
      provides: "Slide animation using transform"
      contains: "translate-x"
    - path: "lineage-ui/src/index.css"
      provides: "Reduced motion accessibility support"
      contains: "prefers-reduced-motion"
  key_links:
    - from: "TableNode.tsx"
      to: "Tailwind CSS classes"
      via: "opacity-20 and opacity-100 classes instead of inline style"
      pattern: "isDimmed.*opacity-20"
    - from: "DetailPanel.tsx"
      to: "Always rendered DOM"
      via: "Transform translateX for visibility instead of conditional render"
      pattern: "translate-x-full|translate-x-0"
---

<objective>
Add smooth CSS transitions to graph interactions for polished user experience.

Purpose: Transform instant visual changes (node highlighting, panel open/close) into smooth animations that feel natural and polished. This establishes the animation patterns used throughout v4.0.

Output: Modified TableNode, ColumnRow, DetailPanel components with CSS-based transitions, and global reduced-motion accessibility support.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-animation-transitions/19-RESEARCH.md

@lineage-ui/src/components/domain/LineageGraph/TableNode/TableNode.tsx
@lineage-ui/src/components/domain/LineageGraph/TableNode/ColumnRow.tsx
@lineage-ui/src/components/domain/LineageGraph/DetailPanel.tsx
@lineage-ui/src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert node/column opacity to CSS transitions</name>
  <files>
    lineage-ui/src/components/domain/LineageGraph/TableNode/TableNode.tsx
    lineage-ui/src/components/domain/LineageGraph/TableNode/ColumnRow.tsx
  </files>
  <action>
Convert inline opacity styles to Tailwind CSS classes to enable smooth transitions.

**TableNode.tsx changes:**
1. Remove `style={{ opacity: isTableDimmed ? 0.2 : 1 }}` from the outer div (line 96)
2. Add these classes to the outer div's className:
   - `transition-opacity duration-200 ease-out`
   - `motion-reduce:transition-none`
   - Conditional: `${isTableDimmed ? 'opacity-20' : 'opacity-100'}`

The className should become:
```tsx
className={`
  min-w-[280px] max-w-[400px]
  ${getBackgroundColor()} rounded-lg border-2 shadow-md
  transition-opacity duration-200 ease-out motion-reduce:transition-none
  ${getBorderColor()}
  ${isTableDimmed ? 'opacity-20' : 'opacity-100'}
`}
```

**ColumnRow.tsx changes:**
1. Remove `style={{ opacity: isDimmed ? 0.2 : 1 }}` from the outer div (line 52)
2. Modify `getRowClassName()` to add transition classes and opacity classes:
   - Add `transition-opacity duration-200 ease-out motion-reduce:transition-none` to base string
   - Add conditional opacity: return `${classes} ${isDimmed ? 'opacity-20' : 'opacity-100'}`
   - Note: The function needs access to `isDimmed` - either pass it as parameter or restructure

Simplest approach for ColumnRow - change the div to apply classes directly:
```tsx
<div
  className={`${getRowClassName()} transition-opacity duration-200 ease-out motion-reduce:transition-none ${isDimmed ? 'opacity-20' : 'opacity-100'}`}
  onClick={handleClick}
  ...
>
```

WHY: Inline styles bypass CSS transitions. Using Tailwind classes with `transition-opacity` ensures the browser can interpolate between opacity values smoothly.
  </action>
  <verify>
Run `npm run build` in lineage-ui - should compile without errors.
Manually test: Select a column, observe that unrelated nodes fade smoothly (200ms) instead of snapping instantly.
  </verify>
  <done>
- TableNode uses `opacity-20`/`opacity-100` CSS classes with `transition-opacity duration-200 ease-out`
- ColumnRow uses `opacity-20`/`opacity-100` CSS classes with `transition-opacity duration-200 ease-out`
- No inline opacity styles remain
- Transitions are disabled when `prefers-reduced-motion` is active (via `motion-reduce:transition-none`)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add slide animation to DetailPanel</name>
  <files>
    lineage-ui/src/components/domain/LineageGraph/DetailPanel.tsx
  </files>
  <action>
Refactor DetailPanel to always render in DOM, controlling visibility with CSS transform instead of conditional render.

**Changes required:**

1. Remove the early return: Delete `if (!isOpen) return null;` (line 79)

2. Update the outer div to use transform-based animation:
```tsx
<div
  data-testid="detail-panel"
  className={`
    fixed right-0 top-0 h-full w-96
    bg-white shadow-xl border-l border-slate-200 z-50
    overflow-y-auto
    transition-transform duration-300 ease-out
    motion-reduce:transition-none
    ${isOpen ? 'translate-x-0' : 'translate-x-full'}
  `}
  role="dialog"
  aria-label={selectedColumn ? 'Column details' : 'Edge details'}
  aria-hidden={!isOpen}
>
```

3. Add `inert` attribute when closed for accessibility (prevents focus trapping):
```tsx
// Use the inert attribute - React 19+ supports this natively
// For older React, use data-inert or a ref approach
{...(!isOpen && { inert: '' })}
```

If `inert` causes TypeScript issues, use a workaround:
```tsx
// Add to props spread
{...(!isOpen ? { 'aria-hidden': true, tabIndex: -1 } : {})}
```

WHY:
- Conditional render (`{isOpen && <Panel/>}`) unmounts the component before exit animation can play
- Transform animations are GPU-accelerated and don't trigger layout recalculation
- `translate-x-full` moves panel fully off-screen to the right; `translate-x-0` brings it back
- 300ms is slightly longer than 200ms to make the panel feel substantial
  </action>
  <verify>
Run `npm run build` in lineage-ui - should compile without errors.
Manually test: Open detail panel (click column), observe smooth slide-in from right. Close panel, observe smooth slide-out to right.
  </verify>
  <done>
- DetailPanel always renders (no conditional return based on isOpen)
- Panel uses `translate-x-full`/`translate-x-0` for visibility
- Transition is 300ms with ease-out timing
- Panel is properly hidden from accessibility tree when closed (aria-hidden)
- Transition disabled for reduced-motion users
  </done>
</task>

<task type="auto">
  <name>Task 3: Add reduced-motion accessibility support</name>
  <files>
    lineage-ui/src/index.css
  </files>
  <action>
Add global CSS media query to respect user's reduced motion preference for any animations not covered by Tailwind's `motion-reduce:` variant.

**Add to index.css after the existing styles:**

```css
/* Accessibility: Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
```

This is a global fallback that ensures:
- Any CSS animations (like the edge dash-flow animation) are effectively disabled
- Any transitions we might have missed with `motion-reduce:` are caught
- Scroll behavior doesn't animate

The Tailwind `motion-reduce:transition-none` classes in Task 1 and 2 handle the specific components, but this global rule catches everything else (like the LineageEdge dash animation).

WHY: WCAG 2.1 Success Criterion 2.3.3 requires respecting user motion preferences. Some users experience vestibular disorders or motion sickness from animations.
  </action>
  <verify>
1. Run `npm run build` - should compile without errors
2. Open browser DevTools, go to Rendering tab, enable "Emulate CSS media feature prefers-reduced-motion"
3. Set to "reduce" and reload app
4. Verify: Node highlighting should snap instantly, panel should appear/disappear instantly, edge animations should stop
  </verify>
  <done>
- index.css contains `@media (prefers-reduced-motion: reduce)` rule
- Rule sets animation-duration and transition-duration to near-zero
- All animations in the app are disabled when user prefers reduced motion
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build verification:**
   ```bash
   cd lineage-ui && npm run build
   ```
   Must complete without errors.

2. **Type check:**
   ```bash
   cd lineage-ui && npm run lint
   ```
   No new TypeScript or linting errors.

3. **Unit tests:**
   ```bash
   cd lineage-ui && npm test
   ```
   Existing tests should pass (animation changes shouldn't break functionality).

4. **Manual verification (requires running app):**
   - Start app: `npm run dev`
   - Load a lineage graph with multiple nodes
   - Click a column to select it
   - Observe: Unrelated nodes should fade smoothly (not snap)
   - Click "i" button or equivalent to open detail panel
   - Observe: Panel should slide in from right smoothly
   - Close panel
   - Observe: Panel should slide out to right smoothly
   - Enable reduced motion in browser DevTools
   - Repeat above - all changes should be instant
</verification>

<success_criteria>
Requirements coverage:
- ANIM-01: Smooth opacity transitions when highlighting nodes - covered by Task 1
- ANIM-02: Smooth transitions when dimming unrelated nodes - covered by Task 1
- ANIM-03: Panel slides in/out with animation - covered by Task 2
- ANIM-04: Consistent ease-out timing - covered by all tasks (duration-200/300, ease-out)

Measurable outcomes:
1. No inline `style={{ opacity: ... }}` in TableNode.tsx or ColumnRow.tsx
2. DetailPanel.tsx contains `translate-x-full` and `translate-x-0`
3. index.css contains `prefers-reduced-motion` media query
4. Build passes, tests pass, no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/19-animation-transitions/19-01-SUMMARY.md`
</output>
