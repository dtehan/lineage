---
phase: 06-security-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/SECURITY.md
autonomous: true

must_haves:
  truths:
    - "DevOps engineer can deploy the API securely using only the documentation"
    - "Documentation describes authentication proxy deployment pattern with examples"
    - "Rate limiting recommendations are specific and actionable (requests per minute)"
    - "Security headers are listed with exact values"
    - "CORS and TLS requirements are documented"
    - "Development vs production modes are distinguished"
  artifacts:
    - path: "docs/SECURITY.md"
      provides: "Security deployment documentation"
      min_lines: 200
      contains: "## Production Deployment Requirements"
  key_links:
    - from: "docs/SECURITY.md"
      to: "OWASP guidelines"
      via: "reference links"
      pattern: "owasp.org"
---

<objective>
Create comprehensive security documentation that enables secure production deployment of the lineage API.

Purpose: The API intentionally does not implement authentication or rate limiting internally, following the pattern of deploying behind an authentication proxy. This documentation ensures DevOps engineers understand and correctly implement the security requirements at the infrastructure layer.

Output: `docs/SECURITY.md` - A complete security deployment guide covering authentication proxy patterns, rate limiting recommendations, security headers, TLS requirements, and CORS configuration.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-security-documentation/06-RESEARCH.md
@lineage-api/internal/adapter/inbound/http/router.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create comprehensive security documentation</name>
  <files>docs/SECURITY.md</files>
  <action>
Create `docs/SECURITY.md` following the structure and content from 06-RESEARCH.md. The documentation must be actionable - a DevOps engineer should be able to deploy securely using only this file.

**Required sections:**

1. **Overview**
   - Explain that this API is designed to run behind an authentication proxy
   - State that it does NOT implement authentication internally (this is intentional)
   - Clarify that rate limiting and security headers are infrastructure responsibilities
   - Link to OWASP REST Security Cheat Sheet for reference

2. **Production Deployment Requirements**

   2.1 **TLS Requirements**
   - All traffic MUST use HTTPS (no HTTP in production)
   - Minimum TLS 1.2, recommend TLS 1.3
   - HSTS header required with specific values
   - Reference Let's Encrypt / Cert Manager for automation

   2.2 **Authentication Requirements**
   - API Gateway or OAuth2-Proxy REQUIRED in front of API
   - Document supported patterns: ForwardAuth, API Gateway
   - List headers the API expects from proxy: X-Auth-Request-User, X-Auth-Request-Email
   - Note: API currently ignores these headers (no internal authz) but they should be passed for audit logging

   2.3 **Rate Limiting Requirements** (use values from 06-RESEARCH.md)
   - Table of recommended limits by endpoint category:
     | Endpoint | Per-IP | Per-User | Rationale |
     | Read endpoints (GET /assets, /lineage) | 100/min | 300/min | Normal browsing |
     | Search endpoint (GET /search) | 30/min | 60/min | Heavier DB queries |
     | Impact analysis (GET /impact) | 20/min | 40/min | Expensive recursive queries |
     | Health check | 1000/min | unlimited | Monitoring systems |
   - Burst handling: allow 10-20 requests above limit
   - Return 429 Too Many Requests with Retry-After header

   2.4 **Security Headers** (from OWASP)
   - Required headers with exact values:
     ```
     Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
     X-Content-Type-Options: nosniff
     X-Frame-Options: DENY
     Referrer-Policy: strict-origin-when-cross-origin
     Cache-Control: no-store
     ```
   - Headers to remove: Server, X-Powered-By

   2.5 **CORS Configuration**
   - Document current development CORS (localhost:3000, localhost:5173)
   - Production requirement: explicit origin allowlist (no wildcards)
   - Example production values
   - Reference existing router.go CORS configuration

3. **Development Setup**
   - Document that auth is NOT required for local development
   - Explain how to run API directly (port 8080)
   - Note: CORS already configured for localhost development origins

4. **Example Configurations**
   Include copy-paste examples for:

   4.1 **Traefik + OAuth2-Proxy** (Docker Compose snippet)
   4.2 **Nginx** (server block with security headers and rate limiting)
   4.3 **Kubernetes Ingress** (annotations for auth and rate limiting)

   Keep examples minimal but complete - enough to get started.

5. **Verification Checklist**
   Numbered checklist for DevOps to verify deployment:
   - [ ] HTTPS only (HTTP redirects or blocked)
   - [ ] Authentication proxy in front of API
   - [ ] Rate limiting configured
   - [ ] Security headers present (test with curl -I)
   - [ ] CORS origin allowlist configured
   - [ ] Server/X-Powered-By headers removed

**Writing style:**
- Direct and actionable ("MUST", "REQUIRED", not "should consider")
- Include exact values, not just descriptions
- Assume reader is a DevOps engineer, not a developer
- No enterprise jargon or unnecessary padding

**DO NOT:**
- Include implementation details for auth (that's infrastructure's job)
- Recommend specific IdP (document pattern generically)
- Make the document longer than necessary
  </action>
  <verify>
    - File exists: `ls docs/SECURITY.md`
    - Has required sections: `grep -c "## " docs/SECURITY.md` shows 5+ sections
    - Contains rate limiting table: `grep "100/min" docs/SECURITY.md`
    - Contains security headers: `grep "Strict-Transport-Security" docs/SECURITY.md`
    - Contains example configs: `grep -c "```" docs/SECURITY.md` shows multiple code blocks
    - References OWASP: `grep "owasp.org" docs/SECURITY.md`
  </verify>
  <done>
    - docs/SECURITY.md exists with 200+ lines
    - All 5 major sections present (Overview, Requirements, Dev Setup, Examples, Checklist)
    - Rate limiting recommendations include specific numbers
    - Security headers listed with exact values
    - At least 3 example configurations (Traefik, Nginx, K8s)
    - Document is actionable - DevOps can deploy using only this file
  </done>
</task>

</tasks>

<verification>
- [ ] docs/SECURITY.md file created
- [ ] Document covers all SEC-06 requirements
- [ ] Authentication proxy pattern documented with examples
- [ ] Rate limiting recommendations are specific (requests/min)
- [ ] Security headers documented with exact values
- [ ] CORS requirements documented
- [ ] TLS requirements documented
- [ ] Development vs production modes distinguished
- [ ] Verification checklist included
</verification>

<success_criteria>
Phase 6 success criteria (from ROADMAP.md):
1. Security documentation describes authentication proxy deployment pattern - VERIFIED by examples section
2. Documentation includes rate limiting recommendations (requests per minute, per IP) - VERIFIED by rate limiting table
3. CORS, TLS, and other security header requirements are documented - VERIFIED by dedicated sections
</success_criteria>

<output>
After completion, create `.planning/phases/06-security-documentation/06-01-SUMMARY.md`
</output>
