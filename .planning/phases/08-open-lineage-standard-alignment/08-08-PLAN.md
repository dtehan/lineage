---
phase: 08-open-lineage-standard-alignment
plan: 08
type: execute
wave: 5
depends_on: ["08-04", "08-05"]
files_modified:
  - lineage-api/cmd/server/main.go
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "v2 API endpoints respond to HTTP requests at /api/v2/openlineage/*"
    - "OpenLineage handler is instantiated with proper dependency injection"
    - "Server starts without errors with OpenLineage routes enabled"
  artifacts:
    - path: "lineage-api/cmd/server/main.go"
      provides: "OpenLineage component wiring"
      contains: "NewOpenLineageRepository"
  key_links:
    - from: "main.go"
      to: "OpenLineageRepository"
      via: "teradata.NewOpenLineageRepository(db)"
    - from: "main.go"
      to: "OpenLineageService"
      via: "application.NewOpenLineageService(olRepo)"
    - from: "main.go"
      to: "OpenLineageHandler"
      via: "httpAdapter.NewOpenLineageHandler(olService)"
    - from: "main.go"
      to: "Router"
      via: "httpAdapter.NewRouter(handler, olHandler)"
---

<objective>
Wire OpenLineage components in main.go to enable v2 API endpoints at runtime.

Purpose: Complete the OpenLineage standard alignment by exposing the v2 API. All implementation layers exist (repository, service, handlers) but are not wired in the application entry point.

Output: Working v2 API at /api/v2/openlineage/* with proper dependency injection chain.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-open-lineage-standard-alignment/08-VERIFICATION.md

# Gap being closed
The verification report identified that olHandler is set to nil in main.go (line 60),
preventing v2 API routes from being registered. All implementation exists:
- OpenLineageRepository in teradata/openlineage_repo.go
- OpenLineageService in application/openlineage_service.go
- OpenLineageHandler in http/openlineage_handlers.go
- Router conditionally registers v2 routes if olHandler != nil

# Reference for wiring pattern
@lineage-api/cmd/server/main.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire OpenLineage dependency injection chain</name>
  <files>lineage-api/cmd/server/main.go</files>
  <action>
Replace the nil OpenLineage handler with proper instantiation following the v1 pattern.

In main.go, replace lines 58-60:
```go
// OpenLineage handler (nil until repository implementation is available)
// TODO: Wire up OpenLineageHandler when OpenLineageRepository is implemented
var olHandler *httpAdapter.OpenLineageHandler = nil
```

With:
```go
// OpenLineage repository, service, and handler
olRepo := teradata.NewOpenLineageRepository(db)
olService := application.NewOpenLineageService(olRepo)
olHandler := httpAdapter.NewOpenLineageHandler(olService)
```

This mirrors the existing v1 pattern used for assetRepo/assetService and lineageRepo/lineageService.

Note: No new imports are needed - all packages (teradata, application, httpAdapter) are already imported.
  </action>
  <verify>
Run: `cd /Users/Daniel.Tehan/Code/lineage/lineage-api && go build ./cmd/server/`
Build must succeed with no errors.
  </verify>
  <done>
OpenLineage components are instantiated and passed to NewRouter. Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify v2 API routes are registered</name>
  <files>lineage-api/cmd/server/main.go</files>
  <action>
Start the server and verify v2 API endpoints respond:

1. Start the Go server (may need mock or test database)
2. Make HTTP requests to v2 endpoints
3. Verify responses indicate routes are registered (not 404)

If the database is not available for a full test, at minimum verify:
- The code compiles
- The router receives a non-nil olHandler
- A code review shows the wiring follows the same pattern as v1
  </action>
  <verify>
Run: `cd /Users/Daniel.Tehan/Code/lineage/lineage-api && go vet ./...`
Verify no issues are found with the new code.

Grep to confirm wiring exists:
`grep -n "NewOpenLineageRepository\|NewOpenLineageService\|NewOpenLineageHandler" lineage-api/cmd/server/main.go`
Should show 3 lines with the instantiation calls.
  </verify>
  <done>
go vet passes. grep confirms all three OpenLineage constructors are called in main.go.
  </done>
</task>

</tasks>

<verification>
1. `go build ./cmd/server/` succeeds without errors
2. `go vet ./...` reports no issues
3. main.go contains NewOpenLineageRepository, NewOpenLineageService, NewOpenLineageHandler calls
4. olHandler passed to NewRouter is not nil
</verification>

<success_criteria>
- Build succeeds: Go compiler accepts the wiring code
- No TODO/nil: The placeholder nil assignment is replaced with actual instantiation
- Pattern match: Wiring follows the same dependency injection pattern as v1 components
- Routes enabled: Router receives non-nil olHandler, enabling v2 route registration
</success_criteria>

<output>
After completion, create `.planning/phases/08-open-lineage-standard-alignment/08-08-SUMMARY.md`
</output>
