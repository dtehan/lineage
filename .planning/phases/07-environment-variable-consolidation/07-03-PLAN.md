---
phase: 07-environment-variable-consolidation
plan: 03
type: execute
wave: 2
depends_on: ["07-01", "07-02"]
files_modified:
  - .env.example
  - CLAUDE.md
  - docs/user_guide.md
  - docs/SECURITY.md
autonomous: true

must_haves:
  truths:
    - ".env.example documents TERADATA_* as primary with TD_* deprecated"
    - ".env.example uses API_PORT (not PORT)"
    - "CLAUDE.md environment variable table shows consolidated naming"
    - "User guide shows updated configuration examples"
    - "SECURITY.md uses API_PORT in examples"
  artifacts:
    - path: ".env.example"
      provides: "Consolidated environment variable template"
      contains: "API_PORT"
    - path: "CLAUDE.md"
      provides: "Updated configuration documentation"
      contains: "TERADATA_HOST"
    - path: "docs/user_guide.md"
      provides: "Updated user-facing configuration docs"
      contains: "TERADATA_HOST"
    - path: "docs/SECURITY.md"
      provides: "Updated security deployment docs"
      contains: "API_PORT"
  key_links:
    - from: ".env.example"
      to: "database/db_config.py"
      via: "environment variable names match"
      pattern: "TERADATA_HOST"
    - from: ".env.example"
      to: "lineage-api/internal/infrastructure/config/config.go"
      via: "environment variable names match"
      pattern: "API_PORT"
---

<objective>
Update all documentation to reflect the consolidated environment variable naming scheme.

Purpose: Ensure users have clear, consistent documentation showing TERADATA_* as primary variables with TD_* as deprecated legacy aliases, and API_PORT as the server port.
Output: Updated .env.example, CLAUDE.md, user_guide.md, and SECURITY.md with consolidated configuration documentation.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-environment-variable-consolidation/07-RESEARCH.md

# Files to update
@.env.example
@CLAUDE.md
@docs/user_guide.md
@docs/SECURITY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Consolidate .env.example</name>
  <files>.env.example</files>
  <action>
Rewrite .env.example to show a single, consolidated configuration with deprecation notes.

Replace the entire contents with:

```bash
# Lineage Application Environment Configuration
# Copy this file to .env and update with your values
# Environment variables take precedence over .env file values

# =============================================================================
# Teradata Database Connection (used by all Python scripts and both servers)
# =============================================================================

# Primary variable names (recommended)
TERADATA_HOST=your-teradata-host.example.com
TERADATA_USER=your_username
TERADATA_PASSWORD=your_password
TERADATA_DATABASE=demo_user
TERADATA_PORT=1025

# Legacy aliases (deprecated - still supported for backwards compatibility)
# If you have existing deployments using TD_* variables, they will continue to
# work. However, we recommend migrating to TERADATA_* for consistency.
# TD_HOST, TD_USER, TD_PASSWORD, TD_DATABASE are supported as fallbacks.

# =============================================================================
# Server Configuration
# =============================================================================

# API server port (used by Go server and Python Flask server)
API_PORT=8080

# Legacy alias (deprecated - still supported for backwards compatibility)
# PORT is supported as a fallback for API_PORT

# =============================================================================
# Redis Cache (Optional)
# =============================================================================
# Used by: Go server
# If Redis is unavailable, the application falls back gracefully

REDIS_ADDR=localhost:6379
REDIS_PASSWORD=
REDIS_DB=0

# =============================================================================
# Validation Configuration
# =============================================================================

VALIDATION_MAX_DEPTH_LIMIT=20
VALIDATION_DEFAULT_MAX_DEPTH=5
VALIDATION_MIN_MAX_DEPTH=1
```

Key changes from current file:
1. Removed separate TD_* section - now just documented as deprecated aliases
2. Changed PORT to API_PORT
3. Added clear deprecation notes
4. Simplified structure to single set of variables
  </action>
  <verify>
Verify file exists and has correct structure:
```bash
grep "TERADATA_HOST" /Users/Daniel.Tehan/Code/lineage/.env.example
grep "API_PORT" /Users/Daniel.Tehan/Code/lineage/.env.example
grep -c "TD_HOST" /Users/Daniel.Tehan/Code/lineage/.env.example  # Should be 1 (in deprecation note only)
```
  </verify>
  <done>
- .env.example shows TERADATA_* as primary variables
- .env.example uses API_PORT (not PORT)
- TD_* and PORT documented as deprecated fallbacks
- Clear section headers for organization
  </done>
</task>

<task type="auto">
  <name>Task 2: Update CLAUDE.md and user_guide.md configuration sections</name>
  <files>CLAUDE.md, docs/user_guide.md</files>
  <action>
Update the Configuration/Environment Variables sections in both files.

**CLAUDE.md changes:**

1. In the "Configuration" section, replace the Environment Variables table with:

```markdown
**Environment Variables:**

| Variable | Description | Default |
|----------|-------------|---------|
| `TERADATA_HOST` | Teradata host | - |
| `TERADATA_USER` | Teradata username | - |
| `TERADATA_PASSWORD` | Teradata password (required) | - |
| `TERADATA_DATABASE` | Default database | `demo_user` |
| `TERADATA_PORT` | Teradata port | `1025` |
| `API_PORT` | HTTP server port | `8080` |
| `REDIS_ADDR` | Redis address | `localhost:6379` |
| `REDIS_PASSWORD` | Redis password | - |
| `REDIS_DB` | Redis database number | `0` |

**Legacy aliases (deprecated, still supported):**
- `TD_HOST`, `TD_USER`, `TD_PASSWORD`, `TD_DATABASE` - fallbacks for `TERADATA_*`
- `PORT` - fallback for `API_PORT`
```

2. In the "Database Scripts" structure section, update the db_config.py comment:
   - Change: `db_config.py              # Connection config (uses TD_HOST, TD_USER, TD_PASSWORD env vars)`
   - To: `db_config.py              # Connection config (uses TERADATA_* env vars, TD_* as fallback)`

**docs/user_guide.md changes:**

1. In "Step 1: Database Setup", update the environment variable example:
```bash
export TERADATA_HOST="your-teradata-host"
export TERADATA_USER="your-username"
export TERADATA_PASSWORD="your-password"
export TERADATA_DATABASE="demo_user"
```

2. In "Configuration Reference" > "Environment Variables" sections, update both tables to show consolidated naming:

**Database Scripts (Python):**
| Variable | Description | Default |
|----------|-------------|---------|
| `TERADATA_HOST` | Teradata server hostname | `localhost` |
| `TERADATA_USER` | Teradata username | `demo_user` |
| `TERADATA_PASSWORD` | Teradata password | (required) |
| `TERADATA_DATABASE` | Default database | `demo_user` |
| `TERADATA_PORT` | Teradata port | `1025` |

*Legacy aliases `TD_*` are supported for backwards compatibility.*

**Backend API (Go and Python Flask):**
| Variable | Description | Default |
|----------|-------------|---------|
| `TERADATA_HOST` | Teradata server hostname | - |
| `TERADATA_USER` | Teradata username | - |
| `TERADATA_PASSWORD` | Teradata password | - |
| `TERADATA_DATABASE` | Teradata database name | `demo_user` |
| `TERADATA_PORT` | Teradata port | `1025` |
| `API_PORT` | HTTP server port | `8080` |
| `REDIS_ADDR` | Redis server address | `localhost:6379` |
| `REDIS_PASSWORD` | Redis password | (empty) |

*Legacy aliases: `TD_*` for database, `PORT` for `API_PORT`.*

3. Remove or update any remaining references to TD_* as primary variables throughout the file.
  </action>
  <verify>
Check CLAUDE.md:
```bash
grep "TERADATA_HOST" /Users/Daniel.Tehan/Code/lineage/CLAUDE.md
grep "API_PORT" /Users/Daniel.Tehan/Code/lineage/CLAUDE.md
```

Check user_guide.md:
```bash
grep "TERADATA_HOST" /Users/Daniel.Tehan/Code/lineage/docs/user_guide.md
grep "API_PORT" /Users/Daniel.Tehan/Code/lineage/docs/user_guide.md
```

Verify no conflicting documentation:
```bash
grep -c "TD_HOST=" /Users/Daniel.Tehan/Code/lineage/CLAUDE.md  # Should be 0 (no TD_HOST=value examples)
grep -c "TD_HOST=" /Users/Daniel.Tehan/Code/lineage/docs/user_guide.md  # Should be 0
```
  </verify>
  <done>
- CLAUDE.md shows TERADATA_* as primary variables
- CLAUDE.md shows API_PORT for server port
- CLAUDE.md documents TD_*/PORT as deprecated fallbacks
- user_guide.md configuration examples use TERADATA_*
- user_guide.md environment variable tables are consolidated
- No conflicting documentation showing TD_* as primary
  </done>
</task>

<task type="auto">
  <name>Task 3: Update docs/SECURITY.md PORT references</name>
  <files>docs/SECURITY.md</files>
  <action>
Update SECURITY.md to use API_PORT instead of PORT in the Traefik Docker Compose example.

1. In the "Traefik + OAuth2-Proxy (Docker Compose)" section, the lineage-api service environment section references TD_HOST/TD_USER/TD_PASSWORD. Update these to TERADATA_*:

Change:
```yaml
environment:
  - TERADATA_HOST=${TD_HOST}
  - TERADATA_USER=${TD_USER}
  - TERADATA_PASSWORD=${TD_PASSWORD}
```

To:
```yaml
environment:
  - TERADATA_HOST=${TERADATA_HOST}
  - TERADATA_USER=${TERADATA_USER}
  - TERADATA_PASSWORD=${TERADATA_PASSWORD}
  - API_PORT=8080
```

This is a minor change - the file doesn't heavily reference PORT directly, but the example should be consistent with the new naming.
  </action>
  <verify>
Check SECURITY.md:
```bash
grep "TERADATA_HOST=\${TERADATA_HOST}" /Users/Daniel.Tehan/Code/lineage/docs/SECURITY.md
grep "API_PORT" /Users/Daniel.Tehan/Code/lineage/docs/SECURITY.md || echo "No API_PORT yet - add it"
```
  </verify>
  <done>
- SECURITY.md Docker Compose example uses TERADATA_* variable references
- SECURITY.md example includes API_PORT
- Configuration is consistent across all documentation
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Verify .env.example has consolidated structure:
```bash
head -30 /Users/Daniel.Tehan/Code/lineage/.env.example
```

2. Verify CLAUDE.md environment variable table:
```bash
grep -A 15 "Environment Variables" /Users/Daniel.Tehan/Code/lineage/CLAUDE.md | head -20
```

3. Verify user_guide.md configuration section:
```bash
grep -A 10 "TERADATA_HOST" /Users/Daniel.Tehan/Code/lineage/docs/user_guide.md | head -15
```

4. Cross-check consistency - all files should show TERADATA_* as primary:
```bash
for f in .env.example CLAUDE.md docs/user_guide.md docs/SECURITY.md; do
  echo "=== $f ==="
  grep -c "TERADATA_HOST" "/Users/Daniel.Tehan/Code/lineage/$f" || echo "0"
done
```
</verification>

<success_criteria>
- [ ] .env.example shows TERADATA_* as primary with TD_* deprecated
- [ ] .env.example uses API_PORT (not PORT as primary)
- [ ] CLAUDE.md environment variable table is updated
- [ ] CLAUDE.md notes TD_*/PORT as deprecated fallbacks
- [ ] user_guide.md configuration examples use TERADATA_*
- [ ] user_guide.md environment variable tables are consolidated
- [ ] SECURITY.md Docker example uses TERADATA_* references
- [ ] All documentation is consistent with new naming scheme
</success_criteria>

<output>
After completion, create `.planning/phases/07-environment-variable-consolidation/07-03-SUMMARY.md`
</output>
