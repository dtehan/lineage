---
phase: 19-animation-transitions
plan: 03
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - lineage-ui/src/components/domain/LineageGraph/DetailPanel.test.tsx
autonomous: true

must_haves:
  truths:
    - "DetailPanel tests pass after animation refactor (panel always in DOM)"
    - "Tests verify animation CSS classes are applied correctly"
    - "Tests verify aria-hidden toggles with isOpen state"
  artifacts:
    - path: "lineage-ui/src/components/domain/LineageGraph/DetailPanel.test.tsx"
      provides: "Updated tests for always-rendered animated DetailPanel"
      contains: "translate-x-full"
  key_links:
    - from: "DetailPanel.test.tsx"
      to: "DetailPanel.tsx"
      via: "Class assertions match animation implementation"
      pattern: "toHaveClass|translate-x"
---

<objective>
Update DetailPanel tests to work with the always-rendered animation pattern.

Purpose: Plan 19-01 changes DetailPanel from conditional render (`if (!isOpen) return null`) to always-rendered with CSS transform visibility (`translate-x-full` / `translate-x-0`). This breaks the existing test that asserts `queryByTestId('detail-panel')).not.toBeInTheDocument()` when closed. This plan updates tests to verify the new animation behavior correctly.

Output: Updated DetailPanel.test.tsx with passing tests that verify animation classes, aria-hidden state, and transform-based visibility.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-animation-and-transitions/19-01-SUMMARY.md

@lineage-ui/src/components/domain/LineageGraph/DetailPanel.tsx
@lineage-ui/src/components/domain/LineageGraph/DetailPanel.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update DetailPanel tests for animation behavior</name>
  <files>
    lineage-ui/src/components/domain/LineageGraph/DetailPanel.test.tsx
  </files>
  <action>
Update the existing DetailPanel tests to account for the always-rendered animation pattern from plan 19-01.

**Change 1: Fix TC-COMP-016 "Panel visibility" tests**

The test "does not render when isOpen is false" (line 41-51) currently asserts:
```tsx
expect(screen.queryByTestId('detail-panel')).not.toBeInTheDocument();
```

This will fail because the panel is now always in the DOM. Replace this test with animation-aware assertions:

```tsx
it('is hidden off-screen when isOpen is false', () => {
  render(
    <DetailPanel
      isOpen={false}
      onClose={() => {}}
      selectedColumn={mockColumnDetail}
    />
  );

  const panel = screen.getByTestId('detail-panel');
  expect(panel).toBeInTheDocument();
  expect(panel).toHaveClass('translate-x-full');
  expect(panel).not.toHaveClass('translate-x-0');
  expect(panel).toHaveAttribute('aria-hidden', 'true');
});
```

Also update the "renders when isOpen is true" test to verify animation classes:

```tsx
it('renders visible when isOpen is true', () => {
  render(
    <DetailPanel
      isOpen={true}
      onClose={() => {}}
      selectedColumn={mockColumnDetail}
    />
  );

  const panel = screen.getByTestId('detail-panel');
  expect(panel).toBeInTheDocument();
  expect(panel).toHaveClass('translate-x-0');
  expect(panel).not.toHaveClass('translate-x-full');
});
```

**Change 2: Add animation-specific test group**

Add a new describe block after TC-COMP-016:

```tsx
describe('TC-COMP-016b: Animation classes', () => {
  it('has transition classes for slide animation', () => {
    render(
      <DetailPanel
        isOpen={true}
        onClose={() => {}}
        selectedColumn={mockColumnDetail}
      />
    );

    const panel = screen.getByTestId('detail-panel');
    expect(panel).toHaveClass('transition-transform');
    expect(panel).toHaveClass('duration-300');
    expect(panel).toHaveClass('ease-out');
  });

  it('has reduced motion support', () => {
    render(
      <DetailPanel
        isOpen={true}
        onClose={() => {}}
        selectedColumn={mockColumnDetail}
      />
    );

    const panel = screen.getByTestId('detail-panel');
    expect(panel.className).toContain('motion-reduce');
  });
});
```

**Change 3: Update TC-COMP-020 Accessibility tests**

The existing accessibility tests check `role="dialog"` and `aria-label`. Add a test for `aria-hidden` behavior:

```tsx
it('has aria-hidden true when closed', () => {
  render(
    <DetailPanel
      isOpen={false}
      onClose={() => {}}
      selectedColumn={mockColumnDetail}
    />
  );

  const panel = screen.getByTestId('detail-panel');
  expect(panel).toHaveAttribute('aria-hidden', 'true');
});

it('does not have aria-hidden when open', () => {
  render(
    <DetailPanel
      isOpen={true}
      onClose={() => {}}
      selectedColumn={mockColumnDetail}
    />
  );

  const panel = screen.getByTestId('detail-panel');
  expect(panel).not.toHaveAttribute('aria-hidden', 'true');
});
```

NOTE: When isOpen is true, `aria-hidden` should either be `false` or not present at all, depending on how plan 19-01 implemented it. Check the actual DetailPanel.tsx implementation after 19-01. If it uses `aria-hidden={!isOpen}`, then when open it will be `aria-hidden="false"`. Adjust assertion accordingly:
- If `aria-hidden="false"`: use `expect(panel).toHaveAttribute('aria-hidden', 'false')`
- If `aria-hidden` is not set when open: use `expect(panel).not.toHaveAttribute('aria-hidden')`

**Do NOT change** the following tests (they should still pass as-is):
- TC-COMP-017: Column details display (content rendering is unchanged)
- TC-COMP-018: Edge details display (content rendering is unchanged)
- TC-COMP-019: Panel interactions (click handlers are unchanged)
- TC-COMP-021: Empty state (content rendering is unchanged)

WHY: Tests are executable specifications. When implementation changes from conditional render to always-rendered with animation, the tests must reflect the new contract. The old test asserted "not in DOM when closed" but the new contract is "in DOM but off-screen when closed."
  </action>
  <verify>
Run the full test suite:
```bash
cd lineage-ui && npm test -- --run
```
All tests should pass, including the updated DetailPanel tests.

Specifically verify:
```bash
cd lineage-ui && npm test -- --run DetailPanel
```
Should show all DetailPanel tests passing with no failures.
  </verify>
  <done>
- TC-COMP-016 tests updated: closed panel asserts translate-x-full + aria-hidden instead of not-in-document
- New TC-COMP-016b group verifies transition-transform, duration-300, ease-out classes
- TC-COMP-020 has new tests for aria-hidden toggle behavior
- All existing content/interaction tests (TC-COMP-017 through TC-COMP-021) still pass unchanged
- Full test suite passes with `npm test`
  </done>
</task>

</tasks>

<verification>
After task completes:

1. **Test suite:**
   ```bash
   cd lineage-ui && npm test -- --run
   ```
   All tests pass, zero failures.

2. **DetailPanel-specific tests:**
   ```bash
   cd lineage-ui && npm test -- --run DetailPanel
   ```
   All DetailPanel tests pass.

3. **No regressions:**
   Full test suite has same or greater number of passing tests compared to before.
</verification>

<success_criteria>
1. DetailPanel tests updated for always-rendered animation pattern
2. Tests verify CSS animation classes (translate-x-full, translate-x-0, transition-transform)
3. Tests verify accessibility attributes (aria-hidden)
4. All existing unmodified tests still pass
5. `npm test` exits with 0 failures
</success_criteria>

<output>
After completion, create `.planning/phases/19-animation-and-transitions/19-03-SUMMARY.md`
</output>
