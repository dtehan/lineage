---
phase: 19-animation-transitions
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - lineage-ui/src/components/domain/LineageGraph/LineageEdge.tsx
  - lineage-ui/src/index.css
autonomous: true

must_haves:
  truths:
    - "Edge opacity transitions use same 200ms ease-out timing as nodes"
    - "Edge dash-flow animation is defined in CSS file, not injected via document.createElement"
    - "Edge label tooltip fades in smoothly instead of popping in instantly"
    - "All graph animations use consistent timing (200ms ease-out for interactions, 300ms for panel)"
  artifacts:
    - path: "lineage-ui/src/index.css"
      provides: "Edge dash-flow keyframes and animate-dash class"
      contains: "@keyframes dash-flow"
    - path: "lineage-ui/src/components/domain/LineageGraph/LineageEdge.tsx"
      provides: "Consistent edge transition timing with ease-out"
      contains: "ease-out"
  key_links:
    - from: "LineageEdge.tsx"
      to: "index.css"
      via: "CSS class instead of dynamic style injection"
      pattern: "animate-dash"
    - from: "LineageEdge.tsx edge transition"
      to: "TableNode.tsx node transition"
      via: "Matching 200ms ease-out timing"
      pattern: "200ms ease-out"
---

<objective>
Unify edge animation timing with node transitions and clean up CSS architecture.

Purpose: Plan 19-01 establishes 200ms ease-out as the standard timing for node/column transitions. The edges currently use inline `0.2s` without an easing function, and inject CSS keyframes dynamically via `document.createElement('style')`. This plan brings edges into alignment with the animation system and moves all animation CSS into the proper stylesheet.

Output: Consistent animation timing across all graph elements (nodes, columns, edges), edge keyframes in index.css, and fade-in transitions on edge labels.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-animation-and-transitions/19-RESEARCH.md
@.planning/phases/19-animation-and-transitions/19-01-SUMMARY.md

@lineage-ui/src/components/domain/LineageGraph/LineageEdge.tsx
@lineage-ui/src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move edge keyframes to index.css and unify transition timing</name>
  <files>
    lineage-ui/src/components/domain/LineageGraph/LineageEdge.tsx
    lineage-ui/src/index.css
  </files>
  <action>
Move the dynamically-injected edge animation CSS from LineageEdge.tsx into index.css, and update edge transition timing to match the node animation system.

**index.css changes:**

Add the following BEFORE the `@media (prefers-reduced-motion: reduce)` block that plan 19-01 added (so the reduced-motion rule catches these animations too):

```css
/* Edge animations */
@keyframes dash-flow {
  from {
    stroke-dashoffset: 10;
  }
  to {
    stroke-dashoffset: 0;
  }
}

.animate-dash {
  animation: dash-flow 0.5s linear infinite;
}
```

**LineageEdge.tsx changes:**

1. **Remove the dynamic style injection block** at the bottom of the file (lines 188-206). Delete everything from `const styleSheet = document.createElement('style');` through the closing `}` of the if block. This code creates a `<style>` element at runtime which is fragile (SSR-incompatible, race conditions, no cleanup). The CSS is now in index.css.

2. **Update the inline transition** on the BaseEdge style prop (line 139). Change:
   ```tsx
   transition: 'stroke-width 0.2s, opacity 0.2s',
   ```
   To:
   ```tsx
   transition: 'stroke-width 200ms ease-out, opacity 200ms ease-out',
   ```
   WHY: Nodes use `duration-200 ease-out` (200ms ease-out). Edges should match exactly. The original `0.2s` is numerically identical to 200ms but lacked the ease-out curve, making edges feel subtly different from nodes.

3. **Add fade-in transition to edge label** (the EdgeLabelRenderer div, around line 160). Update the inline style on the label container div to include opacity transition. Change:
   ```tsx
   <div
     style={{
       position: 'absolute',
       transform: `translate(-50%, -50%) translate(${labelX}px,${labelY}px)`,
       pointerEvents: 'none',
     }}
     className="bg-white px-2 py-1 rounded shadow-md text-xs font-medium border border-slate-200"
   >
   ```
   To:
   ```tsx
   <div
     style={{
       position: 'absolute',
       transform: `translate(-50%, -50%) translate(${labelX}px,${labelY}px)`,
       pointerEvents: 'none',
     }}
     className="bg-white px-2 py-1 rounded shadow-md text-xs font-medium border border-slate-200 animate-in fade-in duration-150"
   >
   ```

   NOTE: The `animate-in fade-in duration-150` classes are from Tailwind CSS Animate plugin. Check if tailwindcss-animate is installed. If NOT installed, use a simpler approach - add a CSS class in index.css instead:

   ```css
   /* Edge label fade-in */
   .edge-label-enter {
     animation: fade-in 150ms ease-out;
   }

   @keyframes fade-in {
     from { opacity: 0; }
     to { opacity: 1; }
   }
   ```

   And use `className="... edge-label-enter"` on the label div. This avoids adding a new dependency.

WHY these changes matter:
- Dynamic `document.createElement('style')` is a pattern from early React. Modern apps put all CSS in proper stylesheets where build tools can process, minify, and tree-shake them.
- Inconsistent easing between edges and nodes makes the UI feel disjointed.
- Edge labels popping in instantly while everything else fades feels jarring.
  </action>
  <verify>
1. Run `npm run build` in lineage-ui - should compile without errors
2. Grep the built output to confirm no `document.createElement.*style` in the edge component: `grep -r "createElement.*style" lineage-ui/src/components/domain/LineageGraph/LineageEdge.tsx` should return nothing
3. Verify index.css contains `@keyframes dash-flow` and `.animate-dash`
4. Run `npm test` - existing tests should pass
  </verify>
  <done>
- Dynamic style injection removed from LineageEdge.tsx (no document.createElement)
- Edge keyframes and .animate-dash class defined in index.css
- Edge transition uses `200ms ease-out` matching node transitions
- Edge label has fade-in animation when appearing
- All animation CSS is in index.css where prefers-reduced-motion media query catches it
  </done>
</task>

</tasks>

<verification>
After task completes:

1. **Build verification:**
   ```bash
   cd lineage-ui && npm run build
   ```
   Must complete without errors.

2. **No dynamic style injection:**
   Confirm LineageEdge.tsx no longer contains `document.createElement` or `document.head.appendChild`.

3. **CSS contains edge animations:**
   Confirm index.css contains `@keyframes dash-flow`, `.animate-dash`, and edge label fade-in.

4. **Timing consistency check:**
   - Nodes: `duration-200 ease-out` (from 19-01)
   - Columns: `duration-200 ease-out` (from 19-01)
   - Edges: `200ms ease-out` (this plan)
   - Panel: `duration-300 ease-out` (from 19-01)
   - Edge labels: `150ms ease-out` (this plan)

5. **Unit tests:**
   ```bash
   cd lineage-ui && npm test
   ```
   Existing tests should pass.
</verification>

<success_criteria>
1. No JavaScript-based CSS injection in LineageEdge.tsx
2. All animation keyframes defined in index.css
3. Edge transitions use `200ms ease-out` matching nodes
4. Edge labels fade in instead of popping in
5. prefers-reduced-motion media query covers all new animations
6. Build passes, tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/19-animation-and-transitions/19-02-SUMMARY.md`
</output>
